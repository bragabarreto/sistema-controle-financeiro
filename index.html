<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Controle Financeiro Completo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .sidebar-item:hover { background-color: #f3f4f6; }
        .sidebar-item.active { background-color: #2563eb; color: white; }
        .modal { backdrop-filter: blur(4px); }
        .category-chip { display: inline-block; padding: 4px 8px; border-radius: 12px; font-size: 12px; margin: 2px; }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md mx-4">
            <div class="text-center mb-8">
                <div class="mx-auto h-16 w-16 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-full flex items-center justify-center mb-4">
                    <span class="text-white text-2xl">üîí</span>
                </div>
                <h2 class="text-3xl font-bold text-gray-900">Sistema Financeiro</h2>
                <p class="text-gray-600 mt-2">Acesse sua conta para continuar</p>
            </div>
            
            <form id="loginForm" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Usu√°rio</label>
                    <input id="username" type="text" required 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           placeholder="Digite seu usu√°rio">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Senha</label>
                    <input id="password" type="password" required 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           placeholder="Digite sua senha">
                </div>
                
                <div id="errorMessage" class="hidden bg-red-50 border border-red-200 rounded-lg p-3">
                    <p class="text-sm text-red-700">Usu√°rio ou senha incorretos</p>
                </div>
                
                <button type="submit" class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white py-3 px-4 rounded-lg font-medium hover:from-blue-700 hover:to-indigo-700 transition-all">
                    Entrar
                </button>
            </form>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="hidden min-h-screen flex">
        <!-- Sidebar -->
        <div class="w-64 bg-white shadow-lg">
            <div class="p-6 border-b">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center">
                        <span class="text-white text-lg">üí∞</span>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-gray-900">FinanceControl</h1>
                        <p class="text-sm text-gray-500">Sistema Completo</p>
                    </div>
                </div>
            </div>
            
            <nav class="p-4">
                <div class="space-y-2">
                    <button onclick="showPage('dashboard')" class="sidebar-item w-full flex items-center space-x-3 px-4 py-3 rounded-lg text-left transition-colors active">
                        <span class="text-xl">üè†</span>
                        <div>
                            <div class="font-medium">Dashboard</div>
                            <div class="text-xs opacity-75">Vis√£o geral das finan√ßas</div>
                        </div>
                    </button>
                    
                    <button onclick="showPage('transacoes')" class="sidebar-item w-full flex items-center space-x-3 px-4 py-3 rounded-lg text-left transition-colors">
                        <span class="text-xl">üí≥</span>
                        <div>
                            <div class="font-medium">Transa√ß√µes</div>
                            <div class="text-xs opacity-75">Gastos e receitas</div>
                        </div>
                    </button>
                    
                    <button onclick="showPage('contas')" class="sidebar-item w-full flex items-center space-x-3 px-4 py-3 rounded-lg text-left transition-colors">
                        <span class="text-xl">üè¶</span>
                        <div>
                            <div class="font-medium">Contas</div>
                            <div class="text-xs opacity-75">Bancos e cart√µes</div>
                        </div>
                    </button>
                    
                    <button onclick="showPage('investimentos')" class="sidebar-item w-full flex items-center space-x-3 px-4 py-3 rounded-lg text-left transition-colors">
                        <span class="text-xl">üìà</span>
                        <div>
                            <div class="font-medium">Investimentos</div>
                            <div class="text-xs opacity-75">Aplica√ß√µes e metas</div>
                        </div>
                    </button>
                    
                    <button onclick="showPage('processamento')" class="sidebar-item w-full flex items-center space-x-3 px-4 py-3 rounded-lg text-left transition-colors">
                        <span class="text-xl">ü§ñ</span>
                        <div>
                            <div class="font-medium">Processamento IA</div>
                            <div class="text-xs opacity-75">Documentos e OCR</div>
                        </div>
                    </button>
                    
                    <button onclick="showPage('relatorios')" class="sidebar-item w-full flex items-center space-x-3 px-4 py-3 rounded-lg text-left transition-colors">
                        <span class="text-xl">üìä</span>
                        <div>
                            <div class="font-medium">Relat√≥rios</div>
                            <div class="text-xs opacity-75">Gr√°ficos e an√°lises</div>
                        </div>
                    </button>
                    
                    <button onclick="showPage('configuracoes')" class="sidebar-item w-full flex items-center space-x-3 px-4 py-3 rounded-lg text-left transition-colors">
                        <span class="text-xl">‚öôÔ∏è</span>
                        <div>
                            <div class="font-medium">Configura√ß√µes</div>
                            <div class="text-xs opacity-75">Backup e sistema</div>
                        </div>
                    </button>
                </div>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="flex-1">
            <!-- Header -->
            <header class="bg-white shadow-sm border-b px-6 py-4">
                <div class="flex justify-between items-center">
                    <h2 id="pageTitle" class="text-2xl font-bold text-gray-900">Dashboard</h2>
                    <div class="flex items-center space-x-4">
                        <span class="text-sm text-gray-600">Bem-vindo, <strong>bragabarreto</strong></span>
                        <button onclick="logout()" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
                            Sair
                        </button>
                    </div>
                </div>
            </header>

            <!-- Page Content -->
            <main class="p-6">
                <!-- Dashboard Page -->
                <div id="dashboardPage" class="page-content">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-600">Receitas</p>
                                    <p class="text-2xl font-bold text-green-600" id="totalReceitas">R$ 0,00</p>
                                </div>
                                <span class="text-3xl">üìà</span>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-600">Gastos</p>
                                    <p class="text-2xl font-bold text-red-600" id="totalGastos">R$ 0,00</p>
                                </div>
                                <span class="text-3xl">üìâ</span>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-600">Saldo</p>
                                    <p class="text-2xl font-bold text-blue-600" id="saldo">R$ 0,00</p>
                                </div>
                                <span class="text-3xl">üí∞</span>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-600">Investimentos</p>
                                    <p class="text-2xl font-bold text-purple-600" id="totalInvestimentos">R$ 0,00</p>
                                </div>
                                <span class="text-3xl">üè¶</span>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-lg font-semibold mb-4">Gastos por Categoria</h3>
                            <canvas id="gastosChart" width="400" height="200"></canvas>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-lg font-semibold mb-4">Evolu√ß√£o Mensal</h3>
                            <canvas id="evolucaoChart" width="400" height="200"></canvas>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold mb-4">Transa√ß√µes Recentes</h3>
                        <div id="transacoesRecentes" class="space-y-3">
                            <p class="text-gray-500 text-center py-8">Nenhuma transa√ß√£o encontrada.</p>
                        </div>
                    </div>
                </div>

                <!-- Transa√ß√µes Page -->
                <div id="transacoesPage" class="page-content hidden">
                    <div class="mb-6 flex gap-4">
                        <button onclick="showAddTransactionModal()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                            + Nova Transa√ß√£o
                        </button>
                        <button onclick="showRecurrentModal()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                            üîÑ Gastos Recorrentes
                        </button>
                        <button onclick="showInstallmentModal()" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors">
                            üìÖ Parcelamentos
                        </button>
                    </div>

                    <div class="bg-white rounded-lg shadow">
                        <div class="p-6 border-b">
                            <div class="flex justify-between items-center">
                                <h3 class="text-lg font-semibold">Hist√≥rico de Transa√ß√µes</h3>
                                <div class="flex gap-2">
                                    <select id="filterCategory" class="px-3 py-1 border rounded-lg text-sm">
                                        <option value="">Todas as categorias</option>
                                    </select>
                                    <select id="filterType" class="px-3 py-1 border rounded-lg text-sm">
                                        <option value="">Todos os tipos</option>
                                        <option value="receita">Receitas</option>
                                        <option value="gasto">Gastos</option>
                                        <option value="despesa">Despesas</option>
                                        <option value="investimento">Investimentos</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="p-6">
                            <div id="transacoesList" class="space-y-3">
                                <p class="text-gray-500 text-center py-8">Nenhuma transa√ß√£o encontrada.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Contas Page -->
                <div id="contasPage" class="page-content hidden">
                    <div class="mb-6">
                        <button onclick="showAddAccountModal()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                            + Nova Conta
                        </button>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="contasList">
                        <!-- Contas ser√£o carregadas aqui -->
                    </div>
                </div>

                <!-- Investimentos Page -->
                <div id="investimentosPage" class="page-content hidden">
                    <div class="mb-6 flex gap-4">
                        <button onclick="showAddInvestmentModal()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                            + Novo Investimento
                        </button>
                        <button onclick="showAddGoalModal()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                            üéØ Nova Meta
                        </button>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-lg font-semibold mb-4">Carteira de Investimentos</h3>
                            <div id="investmentsList" class="space-y-3">
                                <p class="text-gray-500 text-center py-8">Nenhum investimento encontrado.</p>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-lg font-semibold mb-4">Metas Financeiras</h3>
                            <div id="goalsList" class="space-y-3">
                                <p class="text-gray-500 text-center py-8">Nenhuma meta encontrada.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Processamento IA Page -->
                <div id="processamentoPage" class="page-content hidden">
                    <div class="mb-6">
                        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6">
                            <div class="flex items-center">
                                <span class="text-yellow-600 text-xl mr-3">‚ö†Ô∏è</span>
                                <div>
                                    <h4 class="font-medium text-yellow-800">Configure sua API Key</h4>
                                    <p class="text-sm text-yellow-700">V√° em Configura√ß√µes para adicionar suas chaves de API dos provedores de IA.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div class="bg-white rounded-lg shadow p-6 text-center">
                            <div class="text-4xl mb-4">üìÑ</div>
                            <h3 class="text-lg font-semibold mb-2">Contracheques</h3>
                            <p class="text-sm text-gray-600 mb-4">Extraia rubricas automaticamente</p>
                            <button onclick="showUploadModal('contracheque')" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                Processar
                            </button>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-6 text-center">
                            <div class="text-4xl mb-4">üè¶</div>
                            <h3 class="text-lg font-semibold mb-2">Extratos Banc√°rios</h3>
                            <p class="text-sm text-gray-600 mb-4">Importe transa√ß√µes automaticamente</p>
                            <button onclick="showUploadModal('extrato')" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                                Processar
                            </button>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-6 text-center">
                            <div class="text-4xl mb-4">üí≥</div>
                            <h3 class="text-lg font-semibold mb-2">Faturas de Cart√£o</h3>
                            <p class="text-sm text-gray-600 mb-4">Identifique compras e parcelamentos</p>
                            <button onclick="showUploadModal('fatura')" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors">
                                Processar
                            </button>
                        </div>
                    </div>

                    <!-- Novos campos para processamento de IA -->
                    <div class="bg-white rounded-lg shadow p-6 mb-8">
                        <h3 class="text-lg font-semibold mb-4">Processamento de SMS e Documentos</h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- SMS de Cart√£o -->
                            <div class="border rounded-lg p-4">
                                <h4 class="font-medium mb-3">üì± SMS de Cart√£o</h4>
                                <p class="text-sm text-gray-600 mb-3">Cole o texto do SMS recebido do seu banco para processamento autom√°tico</p>
                                <textarea id="smsText" rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-lg" 
                                    placeholder="Ex: Compra aprovada no cart√£o final 1234 de R$ 59,90 em MERCADO LIVRE em 10/09/2025"></textarea>
                                <div class="mt-3">
                                    <button onclick="processSMS()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                        Processar SMS
                                    </button>
                                </div>
                            </div>
                            
                            <!-- OCR para PIX/Transa√ß√µes -->
                            <div class="border rounded-lg p-4">
                                <h4 class="font-medium mb-3">üì∑ OCR para PIX/Transa√ß√µes</h4>
                                <p class="text-sm text-gray-600 mb-3">Envie comprovantes de PIX ou transa√ß√µes para processamento</p>
                                <div class="flex items-center justify-center w-full">
                                    <label class="flex flex-col items-center justify-center w-full h-32 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100">
                                        <div class="flex flex-col items-center justify-center pt-5 pb-6">
                                            <svg class="w-8 h-8 mb-3 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                                            </svg>
                                            <p class="mb-1 text-sm text-gray-500">Clique para enviar</p>
                                            <p class="text-xs text-gray-500">PNG, JPG ou PDF</p>
                                        </div>
                                        <input id="pixTransactionFile" type="file" class="hidden" accept=".png,.jpg,.jpeg,.pdf" onchange="processOCR('transaction')"/>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="mt-6">
                            <!-- Documentos para Receitas/Investimentos -->
                            <div class="border rounded-lg p-4">
                                <h4 class="font-medium mb-3">üìë Documentos para Receitas/Investimentos</h4>
                                <p class="text-sm text-gray-600 mb-3">Envie documentos relacionados a receitas ou investimentos</p>
                                <div class="flex items-center justify-center w-full">
                                    <label class="flex flex-col items-center justify-center w-full h-32 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100">
                                        <div class="flex flex-col items-center justify-center pt-5 pb-6">
                                            <svg class="w-8 h-8 mb-3 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                                            </svg>
                                            <p class="mb-1 text-sm text-gray-500">Clique para enviar</p>
                                            <p class="text-xs text-gray-500">PNG, JPG ou PDF</p>
                                        </div>
                                        <input id="incomeInvestmentFile" type="file" class="hidden" accept=".png,.jpg,.jpeg,.pdf" onchange="processOCR('income')"/>
                                    </label>
                                </div>
                                <div class="mt-3">
                                    <select id="documentType" class="px-3 py-2 border rounded-lg">
                                        <option value="income">Receita</option>
                                        <option value="investment">Investimento</option>
                                    </select>
                                    <button onclick="processDocument()" class="ml-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                                        Processar Documento
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold mb-4">Hist√≥rico de Processamentos</h3>
                        <div id="processamentosHistory" class="space-y-3">
                            <p class="text-gray-500 text-center py-8">Nenhum processamento realizado.</p>
                        </div>
                    </div>
                </div>

                <!-- Relat√≥rios Page -->
                <div id="relatoriosPage" class="page-content hidden">
                    <div class="mb-6 flex gap-4">
                        <select id="reportPeriod" class="px-3 py-2 border rounded-lg">
                            <option value="month">Este m√™s</option>
                            <option value="quarter">√öltimos 3 meses</option>
                            <option value="year">Este ano</option>
                            <option value="all">Todos os per√≠odos</option>
                        </select>
                        <button onclick="generateReport()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                            üìä Gerar Relat√≥rio
                        </button>
                        <button onclick="exportReport()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                            üì• Exportar PDF
                        </button>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-lg font-semibold mb-4">Distribui√ß√£o de Gastos</h3>
                            <canvas id="reportGastosChart" width="400" height="300"></canvas>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-lg font-semibold mb-4">Tend√™ncia Mensal</h3>
                            <canvas id="reportTendenciaChart" width="400" height="300"></canvas>
                        </div>
                    </div>

                    <div class="mt-6 bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold mb-4">Resumo Detalhado</h3>
                        <div id="reportSummary" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <!-- Resumo ser√° carregado aqui -->
                        </div>
                    </div>
                </div>

                <!-- Configura√ß√µes Page -->
                <div id="configuracoesPage" class="page-content hidden">
                    <div class="space-y-6">
                        <!-- API Keys -->
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-lg font-semibold mb-4">ü§ñ Configura√ß√µes de IA</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">OpenAI API Key</label>
                                    <input id="openaiKey" type="password" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="sk-...">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Anthropic API Key</label>
                                    <input id="anthropicKey" type="password" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="sk-ant-...">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Google Gemini API Key</label>
                                    <input id="geminiKey" type="password" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="AI...">
                                </div>
                                <button onclick="saveApiKeys()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                    Salvar Chaves
                                </button>
                            </div>
                        </div>

                        <!-- Backup Local -->
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-lg font-semibold mb-4">üíæ Backup Local</h3>
                            <div class="space-y-4">
                                <div class="flex gap-4">
                                    <button onclick="exportData()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                        üì• Exportar Dados
                                    </button>
                                    <input type="file" id="importFile" accept=".json" onchange="importData()" class="hidden">
                                    <button onclick="document.getElementById('importFile').click()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                                        üì§ Importar Dados
                                    </button>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Pasta de Backup</label>
                                    <div class="flex gap-2">
                                        <input id="backupFolder" type="text" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg" value="Downloads/FinanceControl/">
                                        <button onclick="selectBackupFolder()" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors">
                                            üìÅ Selecionar
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Categorias -->
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-lg font-semibold mb-4">üè∑Ô∏è Categorias</h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div>
                                    <div class="flex justify-between items-center mb-3">
                                        <h4 class="font-medium">Categorias de Despesas</h4>
                                        <button onclick="showAddCategoryModal('despesas')" class="text-sm px-2 py-1 bg-blue-100 text-blue-700 rounded hover:bg-blue-200">+ Adicionar</button>
                                    </div>
                                    <div id="despesasCategories" class="space-y-2">
                                        <!-- Categorias ser√£o carregadas aqui -->
                                    </div>
                                </div>
                                <div>
                                    <div class="flex justify-between items-center mb-3">
                                        <h4 class="font-medium">Categorias de Gastos</h4>
                                        <button onclick="showAddCategoryModal('gastos')" class="text-sm px-2 py-1 bg-blue-100 text-blue-700 rounded hover:bg-blue-200">+ Adicionar</button>
                                    </div>
                                    <div id="gastosCategories" class="space-y-2">
                                        <!-- Categorias ser√£o carregadas aqui -->
                                    </div>
                                </div>
                                <div>
                                    <div class="flex justify-between items-center mb-3">
                                        <h4 class="font-medium">Categorias de Investimentos</h4>
                                        <button onclick="showAddCategoryModal('investimentos')" class="text-sm px-2 py-1 bg-blue-100 text-blue-700 rounded hover:bg-blue-200">+ Adicionar</button>
                                    </div>
                                    <div id="investimentosCategories" class="space-y-2">
                                        <!-- Categorias ser√£o carregadas aqui -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Estat√≠sticas -->
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-lg font-semibold mb-4">üìä Estat√≠sticas do Sistema</h3>
                            <div id="systemStats" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                <!-- Estat√≠sticas ser√£o carregadas aqui -->
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Modals -->
    <div id="modalsContainer">
        <!-- Modal de Adicionar Categoria -->
        <div id="addCategoryModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 modal">
            <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md mx-4">
                <h3 class="text-lg font-semibold mb-4">Adicionar Nova Categoria</h3>
                <form id="addCategoryForm" class="space-y-4">
                    <input type="hidden" id="categoryType" value="gastos">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nome da Categoria</label>
                        <input id="categoryName" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="Ex: Alimenta√ß√£o">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">√çcone</label>
                        <div class="grid grid-cols-8 gap-2">
                            <button type="button" onclick="selectIcon('üçΩÔ∏è')" class="p-2 border rounded-lg hover:bg-gray-100">üçΩÔ∏è</button>
                            <button type="button" onclick="selectIcon('üöó')" class="p-2 border rounded-lg hover:bg-gray-100">üöó</button>
                            <button type="button" onclick="selectIcon('üè†')" class="p-2 border rounded-lg hover:bg-gray-100">üè†</button>
                            <button type="button" onclick="selectIcon('üè•')" class="p-2 border rounded-lg hover:bg-gray-100">üè•</button>
                            <button type="button" onclick="selectIcon('üìö')" class="p-2 border rounded-lg hover:bg-gray-100">üìö</button>
                            <button type="button" onclick="selectIcon('üéÆ')" class="p-2 border rounded-lg hover:bg-gray-100">üéÆ</button>
                            <button type="button" onclick="selectIcon('üëï')" class="p-2 border rounded-lg hover:bg-gray-100">üëï</button>
                            <button type="button" onclick="selectIcon('üíÑ')" class="p-2 border rounded-lg hover:bg-gray-100">üíÑ</button>
                            <button type="button" onclick="selectIcon('üêï')" class="p-2 border rounded-lg hover:bg-gray-100">üêï</button>
                            <button type="button" onclick="selectIcon('üìã')" class="p-2 border rounded-lg hover:bg-gray-100">üìã</button>
                            <button type="button" onclick="selectIcon('üõ°Ô∏è')" class="p-2 border rounded-lg hover:bg-gray-100">üõ°Ô∏è</button>
                            <button type="button" onclick="selectIcon('üìà')" class="p-2 border rounded-lg hover:bg-gray-100">üìà</button>
                            <button type="button" onclick="selectIcon('‚ù§Ô∏è')" class="p-2 border rounded-lg hover:bg-gray-100">‚ù§Ô∏è</button>
                            <button type="button" onclick="selectIcon('üì¶')" class="p-2 border rounded-lg hover:bg-gray-100">üì¶</button>
                            <button type="button" onclick="selectIcon('üíº')" class="p-2 border rounded-lg hover:bg-gray-100">üíº</button>
                            <button type="button" onclick="selectIcon('üíª')" class="p-2 border rounded-lg hover:bg-gray-100">üíª</button>
                        </div>
                        <input type="hidden" id="categoryIcon" value="üì¶">
                        <div class="mt-2 text-center">
                            <span id="selectedIcon" class="text-2xl">üì¶</span>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Cor</label>
                        <input id="categoryColor" type="color" class="w-full h-10 border border-gray-300 rounded-lg" value="#6b7280">
                    </div>
                    <div class="flex justify-end space-x-3 pt-4">
                        <button type="button" onclick="closeAddCategoryModal()" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors">
                            Cancelar
                        </button>
                        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                            Adicionar
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal de Upload -->
        <div id="uploadModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 modal">
            <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md mx-4">
                <h3 id="uploadModalTitle" class="text-lg font-semibold mb-4">Processar Documento</h3>
                <div class="space-y-4">
                    <div class="flex items-center justify-center w-full">
                        <label class="flex flex-col items-center justify-center w-full h-32 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100">
                            <div class="flex flex-col items-center justify-center pt-5 pb-6">
                                <svg class="w-8 h-8 mb-3 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                                </svg>
                                <p class="mb-1 text-sm text-gray-500">Clique para enviar</p>
                                <p class="text-xs text-gray-500">PNG, JPG ou PDF</p>
                            </div>
                            <input id="uploadFile" type="file" class="hidden" accept=".png,.jpg,.jpeg,.pdf"/>
                        </label>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Provedor de IA</label>
                        <select id="aiProvider" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                            <option value="openai">OpenAI</option>
                            <option value="anthropic">Anthropic</option>
                            <option value="gemini">Google Gemini</option>
                        </select>
                    </div>
                    <div class="flex justify-end space-x-3 pt-4">
                        <button type="button" onclick="closeUploadModal()" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors">
                            Cancelar
                        </button>
                        <button type="button" onclick="processUploadedFile()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                            Processar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Dados globais
        let transactions = JSON.parse(localStorage.getItem('financial-transactions') || '[]');
        let accounts = JSON.parse(localStorage.getItem('financial-accounts') || '[]');
        let investments = JSON.parse(localStorage.getItem('financial-investments') || '[]');
        let goals = JSON.parse(localStorage.getItem('financial-goals') || '[]');
        let recurrentTransactions = JSON.parse(localStorage.getItem('financial-recurrent') || '[]');
        let installments = JSON.parse(localStorage.getItem('financial-installments') || '[]');
        let processedDocuments = JSON.parse(localStorage.getItem('financial-processed') || '[]');
        let apiKeys = JSON.parse(localStorage.getItem('financial-api-keys') || '{}');
        let isAuthenticated = localStorage.getItem('financial-auth') === 'true';
        let currentUploadType = '';

        // Categorias pr√©-definidas
        const categories = {
            despesas: [
                { name: 'Aluguel', color: '#8b5cf6', icon: 'üè†' },
                { name: 'Condom√≠nio', color: '#6366f1', icon: 'üè¢' },
                { name: '√Ågua', color: '#0891b2', icon: 'üíß' },
                { name: 'Luz', color: '#f59e0b', icon: 'üí°' },
                { name: 'Internet', color: '#3b82f6', icon: 'üåê' },
                { name: 'Telefone', color: '#10b981', icon: 'üì±' },
                { name: 'Impostos', color: '#64748b', icon: 'üìã' }
            ],
            gastos: [
                { name: 'Alimenta√ß√£o', color: '#ef4444', icon: 'üçΩÔ∏è' },
                { name: 'Transporte', color: '#3b82f6', icon: 'üöó' },
                { name: 'Sa√∫de', color: '#10b981', icon: 'üè•' },
                { name: 'Educa√ß√£o', color: '#f59e0b', icon: 'üìö' },
                { name: 'Lazer', color: '#ec4899', icon: 'üéÆ' },
                { name: 'Roupas', color: '#6366f1', icon: 'üëï' },
                { name: 'Beleza', color: '#84cc16', icon: 'üíÑ' },
                { name: 'Pets', color: '#f97316', icon: 'üêï' },
                { name: 'Outros', color: '#6b7280', icon: 'üì¶' }
            ],
            investimentos: [
                { name: 'A√ß√µes', color: '#059669', icon: 'üìà' },
                { name: 'Fundos', color: '#8b5cf6', icon: 'üí∞' },
                { name: 'Tesouro Direto', color: '#0891b2', icon: 'üèõÔ∏è' },
                { name: 'Poupan√ßa', color: '#f59e0b', icon: 'üè¶' },
                { name: 'Criptomoedas', color: '#f97316', icon: '‚Çø' }
            ],
            receitas: [
                { name: 'Sal√°rio', color: '#10b981', icon: 'üíº' },
                { name: 'Freelance', color: '#3b82f6', icon: 'üíª' },
                { name: 'Investimentos', color: '#8b5cf6', icon: 'üìà' },
                { name: 'Aluguel', color: '#f59e0b', icon: 'üè†' },
                { name: 'Vendas', color: '#ef4444', icon: 'üõí' },
                { name: 'Pr√™mios', color: '#ec4899', icon: 'üèÜ' },
                { name: 'Outros', color: '#6b7280', icon: 'üì¶' }
            ]
        };

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            if (isAuthenticated) {
                showMainApp();
            }
            loadCategories();
            setupEventListeners();
        });

        // Autentica√ß√£o
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (username === 'bragabarreto' && password === 'Mimilulu1719#') {
                localStorage.setItem('financial-auth', 'true');
                showMainApp();
            } else {
                document.getElementById('errorMessage').classList.remove('hidden');
            }
        });

        function logout() {
            localStorage.removeItem('financial-auth');
            document.getElementById('loginModal').classList.remove('hidden');
            document.getElementById('mainApp').classList.add('hidden');
        }

        function showMainApp() {
            document.getElementById('loginModal').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            updateDashboard();
            loadApiKeys();
        }

        // Navega√ß√£o
        function showPage(pageId) {
            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.add('hidden');
            });
            
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.classList.remove('active');
            });
            
            document.getElementById(pageId + 'Page').classList.remove('hidden');
            
            const titles = {
                'dashboard': 'Dashboard',
                'transacoes': 'Transa√ß√µes',
                'contas': 'Contas',
                'investimentos': 'Investimentos',
                'processamento': 'Processamento IA',
                'relatorios': 'Relat√≥rios',
                'configuracoes': 'Configura√ß√µes'
            };
            document.getElementById('pageTitle').textContent = titles[pageId];
            
            event.target.closest('.sidebar-item').classList.add('active');
            
            // Carregar conte√∫do espec√≠fico da p√°gina
            switch(pageId) {
                case 'dashboard':
                    updateDashboard();
                    break;
                case 'transacoes':
                    updateTransactionsList();
                    break;
                case 'contas':
                    updateAccountsList();
                    break;
                case 'investimentos':
                    updateInvestmentsList();
                    updateGoalsList();
                    break;
                case 'processamento':
                    updateProcessingHistory();
                    break;
                case 'relatorios':
                    generateReport();
                    break;
                case 'configuracoes':
                    updateSystemStats();
                    break;
            }
        }

        // Dashboard
        function updateDashboard() {
            const receitas = transactions.filter(t => t.type === 'receita').reduce((sum, t) => sum + t.value, 0);
            const gastos = transactions.filter(t => t.type === 'gasto' || t.type === 'despesa').reduce((sum, t) => sum + t.value, 0);
            const saldo = receitas - gastos;
            const totalInvestimentos = investments.reduce((sum, i) => sum + i.currentValue, 0);

            document.getElementById('totalReceitas').textContent = formatCurrency(receitas);
            document.getElementById('totalGastos').textContent = formatCurrency(gastos);
            document.getElementById('saldo').textContent = formatCurrency(saldo);
            document.getElementById('totalInvestimentos').textContent = formatCurrency(totalInvestimentos);

            updateRecentTransactions();
            updateDashboardCharts();
        }

        function updateRecentTransactions() {
            const recent = transactions.slice(-5).reverse();
            const recentHtml = recent.length > 0 ? 
                recent.map(t => `
                    <div class="flex justify-between items-center p-3 border rounded-lg">
                        <div class="flex items-center space-x-3">
                            <span class="text-2xl">${getCategoryIcon(t.category)}</span>
                            <div>
                                <p class="font-medium">${t.description}</p>
                                <p class="text-sm text-gray-500">${t.category} ‚Ä¢ ${formatDate(t.date)}</p>
                            </div>
                        </div>
                        <p class="font-semibold ${t.type === 'receita' || t.type === 'investimento' ? 'text-green-600' : 'text-red-600'}">
                            ${t.type === 'receita' || t.type === 'investimento' ? '+' : '-'}${formatCurrency(Math.abs(t.value))}
                        </p>
                    </div>
                `).join('') :
                '<p class="text-gray-500 text-center py-8">Nenhuma transa√ß√£o encontrada.</p>';
            
            document.getElementById('transacoesRecentes').innerHTML = recentHtml;
        }

        function updateDashboardCharts() {
            // Gr√°fico de gastos por categoria
            const gastosCtx = document.getElementById('gastosChart').getContext('2d');
            const gastosPorCategoria = {};
            
            transactions.filter(t => t.type === 'gasto' || t.type === 'despesa').forEach(t => {
                gastosPorCategoria[t.category] = (gastosPorCategoria[t.category] || 0) + t.value;
            });

            new Chart(gastosCtx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(gastosPorCategoria),
                    datasets: [{
                        data: Object.values(gastosPorCategoria),
                        backgroundColor: Object.keys(gastosPorCategoria).map(cat => getCategoryColor(cat))
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });

            // Gr√°fico de evolu√ß√£o mensal
            const evolucaoCtx = document.getElementById('evolucaoChart').getContext('2d');
            const monthlyData = getMonthlyData();

            new Chart(evolucaoCtx, {
                type: 'line',
                data: {
                    labels: monthlyData.labels,
                    datasets: [{
                        label: 'Receitas',
                        data: monthlyData.receitas,
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)'
                    }, {
                        label: 'Gastos',
                        data: monthlyData.gastos,
                        borderColor: '#ef4444',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        // Fun√ß√µes auxiliares
        function formatCurrency(value) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(value);
        }

        function formatDate(dateString) {
            return new Date(dateString + 'T00:00:00').toLocaleDateString('pt-BR');
        }

        function getCategoryIcon(categoryName) {
            const allCategories = [...categories.gastos, ...categories.despesas, ...categories.investimentos, ...categories.receitas];
            const category = allCategories.find(c => c.name === categoryName);
            return category ? category.icon : 'üì¶';
        }

        function getCategoryColor(categoryName) {
            const allCategories = [...categories.gastos, ...categories.despesas, ...categories.investimentos, ...categories.receitas];
            const category = allCategories.find(c => c.name === categoryName);
            return category ? category.color : '#6b7280';
        }

        function getMonthlyData() {
            const monthlyData = { labels: [], receitas: [], gastos: [] };
            const months = {};
            
            transactions.forEach(t => {
                const month = t.date.substring(0, 7);
                if (!months[month]) {
                    months[month] = { receitas: 0, gastos: 0 };
                }
                if (t.type === 'receita' || t.type === 'investimento') {
                    months[month].receitas += t.value;
                } else {
                    months[month].gastos += t.value;
                }
            });

            Object.keys(months).sort().forEach(month => {
                monthlyData.labels.push(month);
                monthlyData.receitas.push(months[month].receitas);
                monthlyData.gastos.push(months[month].gastos);
            });

            return monthlyData;
        }

        // Carregar categorias
        function loadCategories() {
            const filterCategory = document.getElementById('filterCategory');
            const gastosContainer = document.getElementById('gastosCategories');
            const despesasContainer = document.getElementById('despesasCategories');
            const investimentosContainer = document.getElementById('investimentosCategories');
            const receitasContainer = document.getElementById('receitasCategories');

            if (filterCategory) {
                filterCategory.innerHTML = '<option value="">Todas as categorias</option>';
                
                categories.despesas.forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat.name;
                    option.textContent = cat.name;
                    filterCategory.appendChild(option);
                });

                categories.gastos.forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat.name;
                    option.textContent = cat.name;
                    filterCategory.appendChild(option);
                });

                categories.investimentos.forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat.name;
                    option.textContent = cat.name;
                    filterCategory.appendChild(option);
                });

                categories.receitas.forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat.name;
                    option.textContent = cat.name;
                    filterCategory.appendChild(option);
                });
            }

            if (gastosContainer) {
                gastosContainer.innerHTML = categories.gastos.map(cat => 
                    `<div class="category-chip flex justify-between items-center" style="background-color: ${cat.color}20; color: ${cat.color}; border: 1px solid ${cat.color}40;">
                        <span>${cat.icon} ${cat.name}</span>
                        <button onclick="editCategory('gastos', '${cat.name}')" class="ml-2 text-xs text-gray-500 hover:text-gray-700">‚úèÔ∏è</button>
                    </div>`
                ).join('');
            }

            if (despesasContainer) {
                despesasContainer.innerHTML = categories.despesas.map(cat => 
                    `<div class="category-chip flex justify-between items-center" style="background-color: ${cat.color}20; color: ${cat.color}; border: 1px solid ${cat.color}40;">
                        <span>${cat.icon} ${cat.name}</span>
                        <button onclick="editCategory('despesas', '${cat.name}')" class="ml-2 text-xs text-gray-500 hover:text-gray-700">‚úèÔ∏è</button>
                    </div>`
                ).join('');
            }

            if (investimentosContainer) {
                investimentosContainer.innerHTML = categories.investimentos.map(cat => 
                    `<div class="category-chip flex justify-between items-center" style="background-color: ${cat.color}20; color: ${cat.color}; border: 1px solid ${cat.color}40;">
                        <span>${cat.icon} ${cat.name}</span>
                        <button onclick="editCategory('investimentos', '${cat.name}')" class="ml-2 text-xs text-gray-500 hover:text-gray-700">‚úèÔ∏è</button>
                    </div>`
                ).join('');
            }

            if (receitasContainer) {
                receitasContainer.innerHTML = categories.receitas.map(cat => 
                    `<div class="category-chip flex justify-between items-center" style="background-color: ${cat.color}20; color: ${cat.color}; border: 1px solid ${cat.color}40;">
                        <span>${cat.icon} ${cat.name}</span>
                        <button onclick="editCategory('receitas', '${cat.name}')" class="ml-2 text-xs text-gray-500 hover:text-gray-700">‚úèÔ∏è</button>
                    </div>`
                ).join('');
            }
        }

        // Fun√ß√µes para categorias
        function showAddCategoryModal(type) {
            document.getElementById('categoryType').value = type;
            document.getElementById('addCategoryModal').classList.remove('hidden');
        }

        function closeAddCategoryModal() {
            document.getElementById('addCategoryModal').classList.add('hidden');
        }

        function selectIcon(icon) {
            document.getElementById('categoryIcon').value = icon;
            document.getElementById('selectedIcon').textContent = icon;
        }

        function editCategory(type, name) {
            alert(`Edi√ß√£o da categoria ${name} do tipo ${type} seria implementada aqui`);
        }

        // Fun√ß√µes para processamento de IA
        function showUploadModal(type) {
            currentUploadType = type;
            document.getElementById('uploadModalTitle').textContent = `Processar ${type.charAt(0).toUpperCase() + type.slice(1)}`;
            document.getElementById('uploadModal').classList.remove('hidden');
        }

        function closeUploadModal() {
            document.getElementById('uploadModal').classList.add('hidden');
        }

        function processUploadedFile() {
            const file = document.getElementById('uploadFile').files[0];
            const provider = document.getElementById('aiProvider').value;
            
            if (!file) {
                alert('Por favor, selecione um arquivo para processar.');
                return;
            }
            
            // Simula√ß√£o de processamento
            alert(`Processando ${currentUploadType} com o provedor ${provider}. Arquivo: ${file.name}`);
            
            // Adicionar ao hist√≥rico de processamentos
            const newProcessing = {
                id: Date.now(),
                type: currentUploadType,
                provider: provider,
                filename: file.name,
                date: new Date().toISOString().split('T')[0],
                status: 'Conclu√≠do'
            };
            
            processedDocuments.push(newProcessing);
            localStorage.setItem('financial-processed', JSON.stringify(processedDocuments));
            
            closeUploadModal();
            updateProcessingHistory();
        }

        function processSMS() {
            const smsText = document.getElementById('smsText').value;
            
            if (!smsText) {
                alert('Por favor, insira o texto do SMS.');
                return;
            }
            
            // Simula√ß√£o de processamento
            alert(`Processando SMS: ${smsText}`);
            
            // Adicionar ao hist√≥rico de processamentos
            const newProcessing = {
                id: Date.now(),
                type: 'sms',
                provider: 'openai',
                filename: 'SMS de Cart√£o',
                date: new Date().toISOString().split('T')[0],
                status: 'Conclu√≠do'
            };
            
            processedDocuments.push(newProcessing);
            localStorage.setItem('financial-processed', JSON.stringify(processedDocuments));
            
            document.getElementById('smsText').value = '';
            updateProcessingHistory();
        }

        function processOCR(type) {
            const fileInput = type === 'transaction' ? 'pixTransactionFile' : 'incomeInvestmentFile';
            const file = document.getElementById(fileInput).files[0];
            
            if (!file) {
                alert('Por favor, selecione um arquivo para processar.');
                return;
            }
            
            // Simula√ß√£o de processamento
            alert(`Processando OCR para ${type}. Arquivo: ${file.name}`);
            
            // Adicionar ao hist√≥rico de processamentos
            const newProcessing = {
                id: Date.now(),
                type: type === 'transaction' ? 'pix/transa√ß√£o' : 'receita/investimento',
                provider: 'openai',
                filename: file.name,
                date: new Date().toISOString().split('T')[0],
                status: 'Conclu√≠do'
            };
            
            processedDocuments.push(newProcessing);
            localStorage.setItem('financial-processed', JSON.stringify(processedDocuments));
            
            document.getElementById(fileInput).value = '';
            updateProcessingHistory();
        }

        function processDocument() {
            const file = document.getElementById('incomeInvestmentFile').files[0];
            const type = document.getElementById('documentType').value;
            
            if (!file) {
                alert('Por favor, selecione um documento para processar.');
                return;
            }
            
            // Simula√ß√£o de processamento
            alert(`Processando documento de ${type}. Arquivo: ${file.name}`);
            
            // Adicionar ao hist√≥rico de processamentos
            const newProcessing = {
                id: Date.now(),
                type: type,
                provider: 'openai',
                filename: file.name,
                date: new Date().toISOString().split('T')[0],
                status: 'Conclu√≠do'
            };
            
            processedDocuments.push(newProcessing);
            localStorage.setItem('financial-processed', JSON.stringify(processedDocuments));
            
            document.getElementById('incomeInvestmentFile').value = '';
            updateProcessingHistory();
        }

        function updateProcessingHistory() {
            const historyContainer = document.getElementById('processamentosHistory');
            
            if (processedDocuments.length === 0) {
                historyContainer.innerHTML = '<p class="text-gray-500 text-center py-8">Nenhum processamento realizado.</p>';
                return;
            }
            
            historyContainer.innerHTML = processedDocuments.map(p => `
                <div class="flex justify-between items-center p-3 border rounded-lg">
                    <div>
                        <p class="font-medium">${p.type.charAt(0).toUpperCase() + p.type.slice(1)}: ${p.filename}</p>
                        <p class="text-sm text-gray-500">Provedor: ${p.provider} ‚Ä¢ ${formatDate(p.date)}</p>
                    </div>
                    <span class="px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs font-medium">${p.status}</span>
                </div>
            `).join('');
        }

        // Configurar event listeners
        function setupEventListeners() {
            // Formul√°rio de adicionar categoria
            const addCategoryForm = document.getElementById('addCategoryForm');
            if (addCategoryForm) {
                addCategoryForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const type = document.getElementById('categoryType').value;
                    const name = document.getElementById('categoryName').value;
                    const icon = document.getElementById('categoryIcon').value;
                    const color = document.getElementById('categoryColor').value;
                    
                    if (!name) {
                        alert('Por favor, insira um nome para a categoria.');
                        return;
                    }
                    
                    // Adicionar nova categoria
                    categories[type].push({
                        name: name,
                        icon: icon,
                        color: color
                    });
                    
                    // Salvar categorias no localStorage
                    localStorage.setItem('financial-categories', JSON.stringify(categories));
                    
                    // Atualizar interface
                    loadCategories();
                    closeAddCategoryModal();
                });
            }
        }

        // Fun√ß√µes para API Keys
        function saveApiKeys() {
            const openaiKey = document.getElementById('openaiKey').value;
            const anthropicKey = document.getElementById('anthropicKey').value;
            const geminiKey = document.getElementById('geminiKey').value;
            
            apiKeys = {
                openai: openaiKey,
                anthropic: anthropicKey,
                gemini: geminiKey
            };
            
            localStorage.setItem('financial-api-keys', JSON.stringify(apiKeys));
            alert('Chaves API salvas com sucesso!');
        }

        function loadApiKeys() {
            if (apiKeys.openai) document.getElementById('openaiKey').value = apiKeys.openai;
            if (apiKeys.anthropic) document.getElementById('anthropicKey').value = apiKeys.anthropic;
            if (apiKeys.gemini) document.getElementById('geminiKey').value = apiKeys.gemini;
        }

        // Fun√ß√µes para backup
        function exportData() {
            const data = {
                transactions: transactions,
                accounts: accounts,
                investments: investments,
                goals: goals,
                recurrentTransactions: recurrentTransactions,
                installments: installments,
                processedDocuments: processedDocuments,
                categories: categories
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = 'finance-control-backup-' + new Date().toISOString().split('T')[0] + '.json';
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }

        function importData() {
            const fileInput = document.getElementById('importFile');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('Por favor, selecione um arquivo para importar.');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    // Validar dados
                    if (!data.transactions || !data.categories) {
                        throw new Error('Formato de arquivo inv√°lido.');
                    }
                    
                    // Importar dados
                    transactions = data.transactions || [];
                    accounts = data.accounts || [];
                    investments = data.investments || [];
                    goals = data.goals || [];
                    recurrentTransactions = data.recurrentTransactions || [];
                    installments = data.installments || [];
                    processedDocuments = data.processedDocuments || [];
                    
                    // Atualizar categorias se existirem
                    if (data.categories) {
                        categories.despesas = data.categories.despesas || categories.despesas;
                        categories.gastos = data.categories.gastos || categories.gastos;
                        categories.investimentos = data.categories.investimentos || categories.investimentos;
                        categories.receitas = data.categories.receitas || categories.receitas;
                    }
                    
                    // Salvar no localStorage
                    localStorage.setItem('financial-transactions', JSON.stringify(transactions));
                    localStorage.setItem('financial-accounts', JSON.stringify(accounts));
                    localStorage.setItem('financial-investments', JSON.stringify(investments));
                    localStorage.setItem('financial-goals', JSON.stringify(goals));
                    localStorage.setItem('financial-recurrent', JSON.stringify(recurrentTransactions));
                    localStorage.setItem('financial-installments', JSON.stringify(installments));
                    localStorage.setItem('financial-processed', JSON.stringify(processedDocuments));
                    localStorage.setItem('financial-categories', JSON.stringify(categories));
                    
                    alert('Dados importados com sucesso!');
                    
                    // Atualizar interface
                    updateDashboard();
                    loadCategories();
                    
                } catch (error) {
                    alert('Erro ao importar dados: ' + error.message);
                }
            };
            reader.readAsText(file);
        }

        function selectBackupFolder() {
            const folder = prompt('Digite o caminho da pasta para backup:', document.getElementById('backupFolder').value);
            if (folder) {
                document.getElementById('backupFolder').value = folder;
                localStorage.setItem('financial-backup-folder', folder);
            }
        }

        // Estat√≠sticas do sistema
        function updateSystemStats() {
            const statsContainer = document.getElementById('systemStats');
            
            const stats = [
                { label: 'Transa√ß√µes', value: transactions.length },
                { label: 'Contas', value: accounts.length },
                { label: 'Investimentos', value: investments.length },
                { label: 'Metas', value: goals.length },
                { label: 'Categorias', value: categories.despesas.length + categories.gastos.length + categories.investimentos.length + categories.receitas.length },
                { label: 'Processamentos', value: processedDocuments.length },
                { label: 'Vers√£o', value: '1.0.0' },
                { label: '√öltimo backup', value: localStorage.getItem('financial-last-backup') || 'Nunca' }
            ];
            
            statsContainer.innerHTML = stats.map(s => `
                <div class="p-3 border rounded-lg">
                    <p class="text-sm text-gray-600">${s.label}</p>
                    <p class="text-lg font-semibold">${s.value}</p>
                </div>
            `).join('');
        }

        // Implementa√ß√µes de fun√ß√µes que antes eram placeholders
        function showAddTransactionModal() {
            alert('Adicionar nova transa√ß√£o: Esta funcionalidade est√° sendo implementada. Em breve estar√° dispon√≠vel!');
        }
        
        function showRecurrentModal() {
            alert('Configurar gastos recorrentes: Esta funcionalidade est√° sendo implementada. Em breve estar√° dispon√≠vel!');
        }
        
        function showInstallmentModal() {
            alert('Gerenciar parcelamentos: Esta funcionalidade est√° sendo implementada. Em breve estar√° dispon√≠vel!');
        }
        
        function showAddAccountModal() {
            alert('Adicionar nova conta: Esta funcionalidade est√° sendo implementada. Em breve estar√° dispon√≠vel!');
        }
        
        function showAddInvestmentModal() {
            alert('Adicionar novo investimento: Esta funcionalidade est√° sendo implementada. Em breve estar√° dispon√≠vel!');
        }
        
        function showAddGoalModal() {
            alert('Adicionar nova meta: Esta funcionalidade est√° sendo implementada. Em breve estar√° dispon√≠vel!');
        }
        
        function updateTransactionsList() {
            console.log('Atualizando lista de transa√ß√µes');
            // Implementa√ß√£o futura
        }
        
        function updateAccountsList() {
            console.log('Atualizando lista de contas');
            // Implementa√ß√£o futura
        }
        
        function updateInvestmentsList() {
            console.log('Atualizando lista de investimentos');
            // Implementa√ß√£o futura
        }
        
        function updateGoalsList() {
            console.log('Atualizando lista de metas');
            // Implementa√ß√£o futura
        }
        
        function generateReport() {
            console.log('Gerando relat√≥rio');
            // Implementa√ß√£o futura
        }
        
        function exportReport() {
            console.log('Exportando relat√≥rio');
            // Implementa√ß√£o futura
        }
    </script>
</body>
</html>
