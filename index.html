<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Controle Financeiro Completo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .sidebar-item:hover { background-color: #f3f4f6; }
        .sidebar-item.active { background-color: #2563eb; color: white; }
        .modal { backdrop-filter: blur(4px); }
        .category-chip { display: inline-block; padding: 4px 8px; border-radius: 12px; font-size: 12px; margin: 2px; }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md mx-4">
            <div class="text-center mb-8">
                <div class="mx-auto h-16 w-16 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-full flex items-center justify-center mb-4">
                    <span class="text-white text-2xl">üîí</span>
                </div>
                <h2 class="text-3xl font-bold text-gray-900">Sistema Financeiro</h2>
                <p class="text-gray-600 mt-2">Acesse sua conta para continuar</p>
            </div>
            
            <form id="loginForm" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Usu√°rio</label>
                    <input id="username" type="text" required 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           placeholder="Digite seu usu√°rio">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Senha</label>
                    <input id="password" type="password" required 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           placeholder="Digite sua senha">
                </div>
                
                <div id="errorMessage" class="hidden bg-red-50 border border-red-200 rounded-lg p-3">
                    <p class="text-sm text-red-700">Usu√°rio ou senha incorretos</p>
                </div>
                
                <button type="submit" class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white py-3 px-4 rounded-lg font-medium hover:from-blue-700 hover:to-indigo-700 transition-all">
                    Entrar
                </button>
            </form>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="hidden min-h-screen flex">
        <!-- Sidebar -->
        <div class="w-64 bg-white shadow-lg">
            <div class="p-6 border-b">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center">
                        <span class="text-white text-lg">üí∞</span>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-gray-900">FinanceControl</h1>
                        <p class="text-sm text-gray-500">Sistema Completo</p>
                    </div>
                </div>
            </div>
            
            <nav class="p-4">
                <div class="space-y-2">
                    <button onclick="showPage('dashboard')" class="sidebar-item w-full flex items-center space-x-3 px-4 py-3 rounded-lg text-left transition-colors active">
                        <span class="text-xl">üè†</span>
                        <div>
                            <div class="font-medium">Dashboard</div>
                            <div class="text-xs opacity-75">Vis√£o geral das finan√ßas</div>
                        </div>
                    </button>
                    
                    <button onclick="showPage('transacoes')" class="sidebar-item w-full flex items-center space-x-3 px-4 py-3 rounded-lg text-left transition-colors">
                        <span class="text-xl">üí≥</span>
                        <div>
                            <div class="font-medium">Transa√ß√µes</div>
                            <div class="text-xs opacity-75">Gastos e receitas</div>
                        </div>
                    </button>
                    
                    <button onclick="showPage('contas')" class="sidebar-item w-full flex items-center space-x-3 px-4 py-3 rounded-lg text-left transition-colors">
                        <span class="text-xl">üè¶</span>
                        <div>
                            <div class="font-medium">Contas</div>
                            <div class="text-xs opacity-75">Contas banc√°rias</div>
                        </div>
                    </button>
                    
                    <button onclick="showPage('cartoes')" class="sidebar-item w-full flex items-center space-x-3 px-4 py-3 rounded-lg text-left transition-colors">
                        <span class="text-xl">üí≥</span>
                        <div>
                            <div class="font-medium">Cart√µes</div>
                            <div class="text-xs opacity-75">Cart√µes de cr√©dito</div>
                        </div>
                    </button>
                    
                    <button onclick="showPage('investimentos')" class="sidebar-item w-full flex items-center space-x-3 px-4 py-3 rounded-lg text-left transition-colors">
                        <span class="text-xl">üìà</span>
                        <div>
                            <div class="font-medium">Investimentos</div>
                            <div class="text-xs opacity-75">Aplica√ß√µes e metas</div>
                        </div>
                    </button>
                    
                    <button onclick="showPage('processamento')" class="sidebar-item w-full flex items-center space-x-3 px-4 py-3 rounded-lg text-left transition-colors">
                        <span class="text-xl">ü§ñ</span>
                        <div>
                            <div class="font-medium">Processamento IA</div>
                            <div class="text-xs opacity-75">Documentos e OCR</div>
                        </div>
                    </button>
                    
                    <button onclick="showPage('relatorios')" class="sidebar-item w-full flex items-center space-x-3 px-4 py-3 rounded-lg text-left transition-colors">
                        <span class="text-xl">üìä</span>
                        <div>
                            <div class="font-medium">Relat√≥rios</div>
                            <div class="text-xs opacity-75">Gr√°ficos e an√°lises</div>
                        </div>
                    </button>
                    
                    <button onclick="showPage('configuracoes')" class="sidebar-item w-full flex items-center space-x-3 px-4 py-3 rounded-lg text-left transition-colors">
                        <span class="text-xl">‚öôÔ∏è</span>
                        <div>
                            <div class="font-medium">Configura√ß√µes</div>
                            <div class="text-xs opacity-75">Backup e sistema</div>
                        </div>
                    </button>
                </div>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="flex-1">
            <!-- Header -->
            <header class="bg-white shadow-sm border-b px-6 py-4">
                <div class="flex justify-between items-center">
                    <h2 id="pageTitle" class="text-2xl font-bold text-gray-900">Dashboard</h2>
                    <div class="flex items-center space-x-4">
                        <span class="text-sm text-gray-600">Bem-vindo, <strong>bragabarreto</strong></span>
                        <button onclick="logout()" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
                            Sair
                        </button>
                    </div>
                </div>
            </header>

            <!-- Page Content -->
            <main class="p-6">
                <!-- Dashboard Page -->
                <div id="dashboardPage" class="page-content">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-600">Receitas</p>
                                    <p class="text-2xl font-bold text-green-600" id="totalReceitas">R$ 0,00</p>
                                </div>
                                <span class="text-3xl">üìà</span>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-600">Gastos</p>
                                    <p class="text-2xl font-bold text-red-600" id="totalGastos">R$ 0,00</p>
                                </div>
                                <span class="text-3xl">üìâ</span>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-600">Saldo</p>
                                    <p class="text-2xl font-bold text-blue-600" id="saldo">R$ 0,00</p>
                                </div>
                                <span class="text-3xl">üí∞</span>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-600">Investimentos</p>
                                    <p class="text-2xl font-bold text-purple-600" id="totalInvestimentos">R$ 0,00</p>
                                </div>
                                <span class="text-3xl">üè¶</span>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-lg font-semibold mb-4">Gastos por Categoria</h3>
                            <canvas id="gastosChart" width="400" height="200"></canvas>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-lg font-semibold mb-4">Evolu√ß√£o Mensal</h3>
                            <canvas id="evolucaoChart" width="400" height="200"></canvas>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold mb-4">Transa√ß√µes Recentes</h3>
                        <div id="transacoesRecentes" class="space-y-3">
                            <p class="text-gray-500 text-center py-8">Nenhuma transa√ß√£o encontrada.</p>
                        </div>
                    </div>
                </div>

                <!-- Transa√ß√µes Page -->
                <div id="transacoesPage" class="page-content hidden">
                    <div class="mb-6 flex gap-4">
                        <button onclick="showAddTransactionModal()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                            + Nova Transa√ß√£o
                        </button>
                        <button onclick="showRecurrentModal()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                            üîÑ Gastos Recorrentes
                        </button>
                        <button onclick="showInstallmentModal()" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors">
                            üìÖ Parcelamentos
                        </button>
                    </div>

                    <div class="bg-white rounded-lg shadow">
                        <div class="p-6 border-b">
                            <div class="flex justify-between items-center">
                                <h3 class="text-lg font-semibold">Hist√≥rico de Transa√ß√µes</h3>
                                <div class="flex gap-2">
                                    <select id="filterCategory" class="px-3 py-1 border rounded-lg text-sm">
                                        <option value="">Todas as categorias</option>
                                    </select>
                                    <select id="filterType" class="px-3 py-1 border rounded-lg text-sm">
                                        <option value="">Todos os tipos</option>
                                        <option value="receita">Receitas</option>
                                        <option value="gasto">Gastos</option>
                                        <option value="despesa">Despesas</option>
                                        <option value="investimento">Investimentos</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="p-6">
                            <div id="transacoesList" class="space-y-3">
                                <p class="text-gray-500 text-center py-8">Nenhuma transa√ß√£o encontrada.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Contas Page -->
                <div id="contasPage" class="page-content hidden">
                    <div class="mb-6">
                        <button onclick="showAddAccountModal()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                            + Nova Conta
                        </button>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="contasList">
                        <!-- Contas ser√£o carregadas aqui -->
                    </div>
                </div>

                <!-- Cart√µes Page -->
                <div id="cartoesPage" class="page-content hidden">
                    <div class="mb-6">
                        <button onclick="showAddCardModal()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                            + Novo Cart√£o
                        </button>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="cartoesList">
                        <!-- Cart√µes ser√£o carregados aqui -->
                    </div>

                    <div class="mt-8 bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold mb-4">Faturas Recentes</h3>
                        <div id="faturasList" class="space-y-3">
                            <p class="text-gray-500 text-center py-8">Nenhuma fatura encontrada.</p>
                        </div>
                    </div>
                </div>

                <!-- Investimentos Page -->
                <div id="investimentosPage" class="page-content hidden">
                    <div class="mb-6 flex gap-4">
                        <button onclick="showAddInvestmentModal()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                            + Novo Investimento
                        </button>
                        <button onclick="showAddInvestmentAccountModal()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                            üè¶ Nova Conta de Investimento
                        </button>
                        <button onclick="showAddGoalModal()" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors">
                            üéØ Nova Meta
                        </button>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-lg font-semibold mb-4">Contas de Investimento</h3>
                            <div id="investmentAccountsList" class="space-y-3">
                                <p class="text-gray-500 text-center py-8">Nenhuma conta de investimento encontrada.</p>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-lg font-semibold mb-4">Metas Financeiras</h3>
                            <div id="goalsList" class="space-y-3">
                                <p class="text-gray-500 text-center py-8">Nenhuma meta encontrada.</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold mb-4">Carteira de Investimentos</h3>
                        <div id="investmentsList" class="space-y-3">
                            <p class="text-gray-500 text-center py-8">Nenhum investimento encontrado.</p>
                        </div>
                    </div>
                </div>

                <!-- Processamento IA Page -->
                <div id="processamentoPage" class="page-content hidden">
                    <div class="mb-6">
                        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6">
                            <div class="flex items-center">
                                <span class="text-yellow-600 text-xl mr-3">‚ö†Ô∏è</span>
                                <div>
                                    <h4 class="font-medium text-yellow-800">Configure sua API Key</h4>
                                    <p class="text-sm text-yellow-700">V√° em Configura√ß√µes para adicionar suas chaves de API dos provedores de IA.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div class="bg-white rounded-lg shadow p-6 text-center">
                            <div class="text-4xl mb-4">üìÑ</div>
                            <h3 class="text-lg font-semibold mb-2">Contracheques</h3>
                            <p class="text-sm text-gray-600 mb-4">Extraia rubricas automaticamente</p>
                            <button onclick="showUploadModal('contracheque')" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                Processar
                            </button>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-6 text-center">
                            <div class="text-4xl mb-4">üè¶</div>
                            <h3 class="text-lg font-semibold mb-2">Extratos Banc√°rios</h3>
                            <p class="text-sm text-gray-600 mb-4">Importe transa√ß√µes automaticamente</p>
                            <button onclick="showUploadModal('extrato')" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                                Processar
                            </button>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-6 text-center">
                            <div class="text-4xl mb-4">üí≥</div>
                            <h3 class="text-lg font-semibold mb-2">Faturas de Cart√£o</h3>
                            <p class="text-sm text-gray-600 mb-4">Identifique compras e parcelamentos</p>
                            <button onclick="showUploadModal('fatura')" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors">
                                Processar
                            </button>
                        </div>
                    </div>

                    <!-- Campos para processamento de IA -->
                    <div class="bg-white rounded-lg shadow p-6 mb-8">
                        <h3 class="text-lg font-semibold mb-4">Processamento de SMS e Documentos</h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- SMS de Cart√£o -->
                            <div class="border rounded-lg p-4">
                                <h4 class="font-medium mb-3">üì± SMS de Cart√£o</h4>
                                <p class="text-sm text-gray-600 mb-3">Cole o texto do SMS recebido do seu banco para processamento autom√°tico</p>
                                <textarea id="smsText" rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-lg" 
                                    placeholder="Ex: Compra aprovada no cart√£o final 1234 de R$ 59,90 em MERCADO LIVRE em 10/09/2025"></textarea>
                                <div class="mt-3">
                                    <button onclick="processSMS()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                        Processar SMS
                                    </button>
                                </div>
                            </div>
                            
                            <!-- OCR para PIX/Transa√ß√µes -->
                            <div class="border rounded-lg p-4">
                                <h4 class="font-medium mb-3">üì∑ OCR para PIX/Transa√ß√µes</h4>
                                <p class="text-sm text-gray-600 mb-3">Envie comprovantes de PIX ou transa√ß√µes para processamento</p>
                                <div class="flex items-center justify-center w-full">
                                    <label class="flex flex-col items-center justify-center w-full h-32 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100">
                                        <div class="flex flex-col items-center justify-center pt-5 pb-6">
                                            <svg class="w-8 h-8 mb-3 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                                            </svg>
                                            <p class="mb-1 text-sm text-gray-500">Clique para enviar</p>
                                            <p class="text-xs text-gray-500">PNG, JPG ou PDF</p>
                                        </div>
                                        <input id="pixTransactionFile" type="file" class="hidden" accept=".png,.jpg,.jpeg,.pdf" onchange="processOCR('transaction')"/>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="mt-6">
                            <!-- Documentos para Receitas/Investimentos -->
                            <div class="border rounded-lg p-4">
                                <h4 class="font-medium mb-3">üìë Documentos para Receitas/Investimentos</h4>
                                <p class="text-sm text-gray-600 mb-3">Envie documentos relacionados a receitas ou investimentos</p>
                                <div class="flex items-center justify-center w-full">
                                    <label class="flex flex-col items-center justify-center w-full h-32 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100">
                                        <div class="flex flex-col items-center justify-center pt-5 pb-6">
                                            <svg class="w-8 h-8 mb-3 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                                            </svg>
                                            <p class="mb-1 text-sm text-gray-500">Clique para enviar</p>
                                            <p class="text-xs text-gray-500">PNG, JPG ou PDF</p>
                                        </div>
                                        <input id="incomeInvestmentFile" type="file" class="hidden" accept=".png,.jpg,.jpeg,.pdf" onchange="processOCR('income')"/>
                                    </label>
                                </div>
                                <div class="mt-3">
                                    <select id="documentType" class="px-3 py-2 border rounded-lg">
                                        <option value="income">Receita</option>
                                        <option value="investment">Investimento</option>
                                    </select>
                                    <button onclick="processDocument()" class="ml-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                                        Processar Documento
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold mb-4">Hist√≥rico de Processamentos</h3>
                        <div id="processamentosHistory" class="space-y-3">
                            <p class="text-gray-500 text-center py-8">Nenhum processamento realizado.</p>
                        </div>
                    </div>
                </div>

                <!-- Relat√≥rios Page -->
                <div id="relatoriosPage" class="page-content hidden">
                    <div class="mb-6 flex gap-4">
                        <select id="reportPeriod" class="px-3 py-2 border rounded-lg">
                            <option value="month">Este m√™s</option>
                            <option value="quarter">√öltimos 3 meses</option>
                            <option value="year">Este ano</option>
                            <option value="all">Todos os per√≠odos</option>
                        </select>
                        <button onclick="generateReport()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                            üìä Gerar Relat√≥rio
                        </button>
                        <button onclick="exportReport()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                            üì• Exportar PDF
                        </button>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-lg font-semibold mb-4">Distribui√ß√£o de Gastos</h3>
                            <canvas id="reportGastosChart" width="400" height="300"></canvas>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-lg font-semibold mb-4">Tend√™ncia Mensal</h3>
                            <canvas id="reportTendenciaChart" width="400" height="300"></canvas>
                        </div>
                    </div>

                    <div class="mt-6 bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold mb-4">Resumo Detalhado</h3>
                        <div id="reportSummary" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <!-- Resumo ser√° carregado aqui -->
                        </div>
                    </div>
                </div>

                <!-- Configura√ß√µes Page -->
                <div id="configuracoesPage" class="page-content hidden">
                    <div class="space-y-6">
                        <!-- API Keys -->
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-lg font-semibold mb-4">ü§ñ Configura√ß√µes de IA</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">OpenAI API Key</label>
                                    <input id="openaiKey" type="password" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="sk-...">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Anthropic API Key</label>
                                    <input id="anthropicKey" type="password" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="sk-ant-...">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Google Gemini API Key</label>
                                    <input id="geminiKey" type="password" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="AI...">
                                </div>
                                <button onclick="saveApiKeys()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                    Salvar Chaves
                                </button>
                            </div>
                        </div>

                        <!-- Backup Local -->
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-lg font-semibold mb-4">üíæ Backup Local</h3>
                            <div class="space-y-4">
                                <div class="flex gap-4">
                                    <button onclick="exportData()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                        üì• Exportar Dados
                                    </button>
                                    <input type="file" id="importFile" accept=".json" onchange="importData()" class="hidden">
                                    <button onclick="document.getElementById('importFile').click()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                                        üì§ Importar Dados
                                    </button>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Pasta de Backup</label>
                                    <div class="flex gap-2">
                                        <input id="backupFolder" type="text" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg" value="Downloads/FinanceControl/">
                                        <button onclick="selectBackupFolder()" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors">
                                            üìÅ Selecionar
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Categorias -->
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-lg font-semibold mb-4">üè∑Ô∏è Categorias</h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div>
                                    <div class="flex justify-between items-center mb-3">
                                        <h4 class="font-medium">Categorias de Despesas</h4>
                                        <button onclick="showAddCategoryModal('despesas')" class="text-sm px-2 py-1 bg-blue-100 text-blue-700 rounded hover:bg-blue-200">+ Adicionar</button>
                                    </div>
                                    <div id="despesasCategories" class="space-y-2">
                                        <!-- Categorias ser√£o carregadas aqui -->
                                    </div>
                                </div>
                                <div>
                                    <div class="flex justify-between items-center mb-3">
                                        <h4 class="font-medium">Categorias de Gastos</h4>
                                        <button onclick="showAddCategoryModal('gastos')" class="text-sm px-2 py-1 bg-blue-100 text-blue-700 rounded hover:bg-blue-200">+ Adicionar</button>
                                    </div>
                                    <div id="gastosCategories" class="space-y-2">
                                        <!-- Categorias ser√£o carregadas aqui -->
                                    </div>
                                </div>
                                <div>
                                    <div class="flex justify-between items-center mb-3">
                                        <h4 class="font-medium">Categorias de Investimentos</h4>
                                        <button onclick="showAddCategoryModal('investimentos')" class="text-sm px-2 py-1 bg-blue-100 text-blue-700 rounded hover:bg-blue-200">+ Adicionar</button>
                                    </div>
                                    <div id="investimentosCategories" class="space-y-2">
                                        <!-- Categorias ser√£o carregadas aqui -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Estat√≠sticas -->
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-lg font-semibold mb-4">üìä Estat√≠sticas do Sistema</h3>
                            <div id="systemStats" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                <!-- Estat√≠sticas ser√£o carregadas aqui -->
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Modals -->
    <div id="modalsContainer">
        <!-- Modal de Adicionar Categoria -->
        <div id="addCategoryModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 modal">
            <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md mx-4">
                <h3 class="text-lg font-semibold mb-4">Adicionar Nova Categoria</h3>
                <form id="addCategoryForm" class="space-y-4">
                    <input type="hidden" id="categoryType" value="gastos">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nome da Categoria</label>
                        <input id="categoryName" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="Ex: Alimenta√ß√£o">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">√çcone</label>
                        <div class="grid grid-cols-8 gap-2">
                            <button type="button" onclick="selectIcon('üçΩÔ∏è')" class="p-2 border rounded-lg hover:bg-gray-100">üçΩÔ∏è</button>
                            <button type="button" onclick="selectIcon('üöó')" class="p-2 border rounded-lg hover:bg-gray-100">üöó</button>
                            <button type="button" onclick="selectIcon('üè†')" class="p-2 border rounded-lg hover:bg-gray-100">üè†</button>
                            <button type="button" onclick="selectIcon('üè•')" class="p-2 border rounded-lg hover:bg-gray-100">üè•</button>
                            <button type="button" onclick="selectIcon('üìö')" class="p-2 border rounded-lg hover:bg-gray-100">üìö</button>
                            <button type="button" onclick="selectIcon('üéÆ')" class="p-2 border rounded-lg hover:bg-gray-100">üéÆ</button>
                            <button type="button" onclick="selectIcon('üëï')" class="p-2 border rounded-lg hover:bg-gray-100">üëï</button>
                            <button type="button" onclick="selectIcon('üíÑ')" class="p-2 border rounded-lg hover:bg-gray-100">üíÑ</button>
                            <button type="button" onclick="selectIcon('üêï')" class="p-2 border rounded-lg hover:bg-gray-100">üêï</button>
                            <button type="button" onclick="selectIcon('üìã')" class="p-2 border rounded-lg hover:bg-gray-100">üìã</button>
                            <button type="button" onclick="selectIcon('üõ°Ô∏è')" class="p-2 border rounded-lg hover:bg-gray-100">üõ°Ô∏è</button>
                            <button type="button" onclick="selectIcon('üìà')" class="p-2 border rounded-lg hover:bg-gray-100">üìà</button>
                            <button type="button" onclick="selectIcon('‚ù§Ô∏è')" class="p-2 border rounded-lg hover:bg-gray-100">‚ù§Ô∏è</button>
                            <button type="button" onclick="selectIcon('üì¶')" class="p-2 border rounded-lg hover:bg-gray-100">üì¶</button>
                            <button type="button" onclick="selectIcon('üíº')" class="p-2 border rounded-lg hover:bg-gray-100">üíº</button>
                            <button type="button" onclick="selectIcon('üíª')" class="p-2 border rounded-lg hover:bg-gray-100">üíª</button>
                        </div>
                        <input type="hidden" id="categoryIcon" value="üì¶">
                        <div class="mt-2 text-center">
                            <span id="selectedIcon" class="text-2xl">üì¶</span>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Cor</label>
                        <input id="categoryColor" type="color" class="w-full h-10 border border-gray-300 rounded-lg" value="#6b7280">
                    </div>
                    <div class="flex justify-end space-x-3 pt-4">
                        <button type="button" onclick="closeAddCategoryModal()" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors">
                            Cancelar
                        </button>
                        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                            Adicionar
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal de Upload -->
        <div id="uploadModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 modal">
            <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md mx-4">
                <h3 id="uploadModalTitle" class="text-lg font-semibold mb-4">Processar Documento</h3>
                <div class="space-y-4">
                    <div class="flex items-center justify-center w-full">
                        <label class="flex flex-col items-center justify-center w-full h-32 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100">
                            <div class="flex flex-col items-center justify-center pt-5 pb-6">
                                <svg class="w-8 h-8 mb-3 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                                </svg>
                                <p class="mb-1 text-sm text-gray-500">Clique para enviar</p>
                                <p class="text-xs text-gray-500">PNG, JPG ou PDF</p>
                            </div>
                            <input id="uploadFile" type="file" class="hidden" accept=".png,.jpg,.jpeg,.pdf"/>
                        </label>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Provedor de IA</label>
                        <select id="aiProvider" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                            <option value="openai">OpenAI</option>
                            <option value="anthropic">Anthropic</option>
                            <option value="gemini">Google Gemini</option>
                        </select>
                    </div>
                    <div class="flex justify-end space-x-3 pt-4">
                        <button type="button" onclick="closeUploadModal()" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors">
                            Cancelar
                        </button>
                        <button type="button" onclick="processUploadedFile()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                            Processar
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de Pr√©via de Transa√ß√£o -->
        <div id="transactionPreviewModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 modal">
            <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-2xl mx-4">
                <h3 class="text-lg font-semibold mb-4">Pr√©via da Transa√ß√£o</h3>
                <div class="space-y-4">
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                        <p class="text-sm text-blue-700">A IA identificou os seguintes dados. Por favor, verifique e ajuste se necess√°rio.</p>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Descri√ß√£o da Transa√ß√£o</label>
                        <input id="previewDescription" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Valor</label>
                            <input id="previewValue" type="number" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Data</label>
                            <input id="previewDate" type="date" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Tipo de Transa√ß√£o</label>
                        <select id="previewType" class="w-full px-3 py-2 border border-gray-300 rounded-lg" onchange="updatePreviewFields()">
                            <option value="receita">Receita</option>
                            <option value="despesa">Despesa</option>
                            <option value="investimento">Investimento</option>
                        </select>
                    </div>
                    
                    <!-- Campos espec√≠ficos para Receita -->
                    <div id="previewReceitaFields" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Origem do Recurso</label>
                            <input id="previewOrigemReceita" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Conta de Destino</label>
                            <select id="previewContaDestinoReceita" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                                <!-- Contas ser√£o carregadas aqui -->
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Categoria</label>
                            <select id="previewCategoriaReceita" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                                <!-- Categorias ser√£o carregadas aqui -->
                            </select>
                        </div>
                    </div>
                    
                    <!-- Campos espec√≠ficos para Despesa -->
                    <div id="previewDespesaFields" class="space-y-4 hidden">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Forma de Pagamento</label>
                            <select id="previewFormaPagamento" class="w-full px-3 py-2 border border-gray-300 rounded-lg" onchange="updateFormaPagamentoFields()">
                                <option value="credito">Cart√£o de Cr√©dito</option>
                                <option value="debito">Cart√£o de D√©bito</option>
                                <option value="pix">PIX</option>
                                <option value="transferencia">Transfer√™ncia Banc√°ria</option>
                            </select>
                        </div>
                        
                        <!-- Campos para Cart√£o de Cr√©dito -->
                        <div id="previewCreditoFields">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Cart√£o de Cr√©dito</label>
                            <select id="previewCartaoCredito" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                                <!-- Cart√µes ser√£o carregados aqui -->
                            </select>
                        </div>
                        
                        <!-- Campos para D√©bito/PIX/Transfer√™ncia -->
                        <div id="previewDebitoPixTransfFields" class="hidden">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Conta de Origem</label>
                            <select id="previewContaOrigem" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                                <!-- Contas ser√£o carregadas aqui -->
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Categoria</label>
                            <select id="previewCategoriaDespesa" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                                <!-- Categorias ser√£o carregadas aqui -->
                            </select>
                        </div>
                    </div>
                    
                    <!-- Campos espec√≠ficos para Investimento -->
                    <div id="previewInvestimentoFields" class="space-y-4 hidden">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Tipo de Opera√ß√£o</label>
                            <select id="previewTipoInvestimento" class="w-full px-3 py-2 border border-gray-300 rounded-lg" onchange="updateInvestimentoFields()">
                                <option value="aplicacao">Aplica√ß√£o</option>
                                <option value="resgate">Resgate</option>
                            </select>
                        </div>
                        
                        <!-- Campos para Aplica√ß√£o -->
                        <div id="previewAplicacaoFields">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Conta de Origem</label>
                                <select id="previewContaOrigemInvestimento" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                                    <!-- Contas ser√£o carregadas aqui -->
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Investimento de Destino</label>
                                <select id="previewInvestimentoDestino" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                                    <!-- Investimentos ser√£o carregados aqui -->
                                </select>
                            </div>
                            <div class="flex items-center mt-2">
                                <input id="previewNovoInvestimento" type="checkbox" class="mr-2" onchange="toggleNovoInvestimentoFields()">
                                <label class="text-sm text-gray-700">Cadastrar novo investimento</label>
                            </div>
                            <div id="previewNovoInvestimentoFields" class="mt-3 space-y-3 hidden">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Nome do Investimento</label>
                                    <input id="previewNovoInvestimentoNome" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Tipo de Investimento</label>
                                    <select id="previewNovoInvestimentoTipo" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                                        <option value="cdb">CDB</option>
                                        <option value="lci">LCI</option>
                                        <option value="lca">LCA</option>
                                        <option value="acoes">A√ß√µes</option>
                                        <option value="cripto">Criptomoedas</option>
                                        <option value="fundos">Fundos de Investimento</option>
                                        <option value="outros">Outros</option>
                                    </select>
                                </div>
                                <div id="previewSubtipoContainer" class="hidden">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Subtipo</label>
                                    <input id="previewNovoInvestimentoSubtipo" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Institui√ß√£o Financeira</label>
                                    <input id="previewNovoInvestimentoInstituicao" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Taxa de Rendimento (%)</label>
                                    <input id="previewNovoInvestimentoTaxa" type="number" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Campos para Resgate -->
                        <div id="previewResgateFields" class="hidden">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Investimento de Origem</label>
                                <select id="previewInvestimentoOrigem" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                                    <!-- Investimentos ser√£o carregados aqui -->
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Conta de Destino</label>
                                <select id="previewContaDestinoResgate" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                                    <!-- Contas ser√£o carregadas aqui -->
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex justify-end space-x-3 pt-4">
                        <button type="button" onclick="closeTransactionPreviewModal()" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors">
                            Cancelar
                        </button>
                        <button type="button" onclick="saveTransaction()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                            Salvar Transa√ß√£o
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de Adicionar Conta -->
        <div id="addAccountModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 modal">
            <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md mx-4">
                <h3 class="text-lg font-semibold mb-4">Adicionar Nova Conta</h3>
                <form id="addAccountForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nome da Conta</label>
                        <input id="accountName" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="Ex: Conta Corrente Banco X">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Tipo de Conta</label>
                        <select id="accountType" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                            <option value="corrente">Conta Corrente</option>
                            <option value="poupanca">Conta Poupan√ßa</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Institui√ß√£o Financeira</label>
                        <input id="accountBank" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="Ex: Banco do Brasil">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Saldo Inicial</label>
                        <input id="accountBalance" type="number" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="0.00">
                    </div>
                    <div class="flex justify-end space-x-3 pt-4">
                        <button type="button" onclick="closeAddAccountModal()" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors">
                            Cancelar
                        </button>
                        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                            Adicionar
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal de Adicionar Cart√£o -->
        <div id="addCardModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 modal">
            <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md mx-4">
                <h3 class="text-lg font-semibold mb-4">Adicionar Novo Cart√£o</h3>
                <form id="addCardForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nome do Cart√£o</label>
                        <input id="cardName" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="Ex: Cart√£o Nubank">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Institui√ß√£o Financeira</label>
                        <input id="cardBank" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="Ex: Nubank">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Bandeira</label>
                        <select id="cardFlag" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                            <option value="visa">Visa</option>
                            <option value="mastercard">Mastercard</option>
                            <option value="elo">Elo</option>
                            <option value="amex">American Express</option>
                            <option value="hipercard">Hipercard</option>
                            <option value="outro">Outro</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Limite</label>
                        <input id="cardLimit" type="number" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="0.00">
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Dia de Vencimento</label>
                            <input id="cardDueDay" type="number" min="1" max="31" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="10">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Dia de Fechamento</label>
                            <input id="cardClosingDay" type="number" min="1" max="31" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="3">
                        </div>
                    </div>
                    <div class="flex justify-end space-x-3 pt-4">
                        <button type="button" onclick="closeAddCardModal()" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors">
                            Cancelar
                        </button>
                        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                            Adicionar
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal de Adicionar Conta de Investimento -->
        <div id="addInvestmentAccountModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 modal">
            <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md mx-4">
                <h3 class="text-lg font-semibold mb-4">Adicionar Conta de Investimento</h3>
                <form id="addInvestmentAccountForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nome da Conta</label>
                        <input id="investmentAccountName" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="Ex: Conta Investimento XP">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Institui√ß√£o Financeira</label>
                        <input id="investmentAccountBank" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="Ex: XP Investimentos">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Saldo Inicial</label>
                        <input id="investmentAccountBalance" type="number" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="0.00">
                    </div>
                    <div class="flex justify-end space-x-3 pt-4">
                        <button type="button" onclick="closeAddInvestmentAccountModal()" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors">
                            Cancelar
                        </button>
                        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                            Adicionar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Dados globais
        let transactions = JSON.parse(localStorage.getItem('financial-transactions') || '[]');
        let accounts = JSON.parse(localStorage.getItem('financial-accounts') || '[]');
        let cards = JSON.parse(localStorage.getItem('financial-cards') || '[]');
        let investmentAccounts = JSON.parse(localStorage.getItem('financial-investment-accounts') || '[]');
        let investments = JSON.parse(localStorage.getItem('financial-investments') || '[]');
        let goals = JSON.parse(localStorage.getItem('financial-goals') || '[]');
        let recurrentTransactions = JSON.parse(localStorage.getItem('financial-recurrent') || '[]');
        let installments = JSON.parse(localStorage.getItem('financial-installments') || '[]');
        let processedDocuments = JSON.parse(localStorage.getItem('financial-processed') || '[]');
        let apiKeys = JSON.parse(localStorage.getItem('financial-api-keys') || '{}');
        let isAuthenticated = localStorage.getItem('financial-auth') === 'true';
        let currentUploadType = '';
        let currentPreviewData = {};

        // Categorias pr√©-definidas
        const categories = {
            despesas: [
                { name: 'Aluguel', color: '#8b5cf6', icon: 'üè†' },
                { name: 'Condom√≠nio', color: '#6366f1', icon: 'üè¢' },
                { name: '√Ågua', color: '#0891b2', icon: 'üíß' },
                { name: 'Luz', color: '#f59e0b', icon: 'üí°' },
                { name: 'Internet', color: '#3b82f6', icon: 'üåê' },
                { name: 'Telefone', color: '#10b981', icon: 'üì±' },
                { name: 'Impostos', color: '#64748b', icon: 'üìã' }
            ],
            gastos: [
                { name: 'Alimenta√ß√£o', color: '#ef4444', icon: 'üçΩÔ∏è' },
                { name: 'Transporte', color: '#3b82f6', icon: 'üöó' },
                { name: 'Sa√∫de', color: '#10b981', icon: 'üè•' },
                { name: 'Educa√ß√£o', color: '#f59e0b', icon: 'üìö' },
                { name: 'Lazer', color: '#ec4899', icon: 'üéÆ' },
                { name: 'Roupas', color: '#6366f1', icon: 'üëï' },
                { name: 'Beleza', color: '#84cc16', icon: 'üíÑ' },
                { name: 'Pets', color: '#f97316', icon: 'üêï' },
                { name: 'Outros', color: '#6b7280', icon: 'üì¶' }
            ],
            investimentos: [
                { name: 'A√ß√µes', color: '#059669', icon: 'üìà' },
                { name: 'Fundos', color: '#8b5cf6', icon: 'üí∞' },
                { name: 'Tesouro Direto', color: '#0891b2', icon: 'üèõÔ∏è' },
                { name: 'Poupan√ßa', color: '#f59e0b', icon: 'üè¶' },
                { name: 'Criptomoedas', color: '#f97316', icon: '‚Çø' }
            ],
            receitas: [
                { name: 'Sal√°rio', color: '#10b981', icon: 'üíº' },
                { name: 'Freelance', color: '#3b82f6', icon: 'üíª' },
                { name: 'Investimentos', color: '#8b5cf6', icon: 'üìà' },
                { name: 'Aluguel', color: '#f59e0b', icon: 'üè†' },
                { name: 'Vendas', color: '#ef4444', icon: 'üõí' },
                { name: 'Pr√™mios', color: '#ec4899', icon: 'üèÜ' },
                { name: 'Outros', color: '#6b7280', icon: 'üì¶' }
            ]
        };

        // Tipos de investimento
        const investmentTypes = {
            cdb: { name: 'CDB', hasSubtype: false },
            lci: { name: 'LCI', hasSubtype: false },
            lca: { name: 'LCA', hasSubtype: false },
            acoes: { name: 'A√ß√µes', hasSubtype: true, subtypeLabel: 'Ticker' },
            cripto: { name: 'Criptomoedas', hasSubtype: true, subtypeLabel: 'Moeda' },
            fundos: { name: 'Fundos de Investimento', hasSubtype: true, subtypeLabel: 'Nome do Fundo' },
            outros: { name: 'Outros', hasSubtype: true, subtypeLabel: 'Especifica√ß√£o' }
        };

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            if (isAuthenticated) {
                showMainApp();
            }
            loadCategories();
            setupEventListeners();
        });

        // Autentica√ß√£o
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (username === 'bragabarreto' && password === 'Mimilulu1719#') {
                localStorage.setItem('financial-auth', 'true');
                showMainApp();
            } else {
                document.getElementById('errorMessage').classList.remove('hidden');
            }
        });

        function logout() {
            localStorage.removeItem('financial-auth');
            document.getElementById('loginModal').classList.remove('hidden');
            document.getElementById('mainApp').classList.add('hidden');
        }

        function showMainApp() {
            document.getElementById('loginModal').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            updateDashboard();
            loadApiKeys();
        }

        // Navega√ß√£o
        function showPage(pageId) {
            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.add('hidden');
            });
            
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.classList.remove('active');
            });
            
            document.getElementById(pageId + 'Page').classList.remove('hidden');
            
            const titles = {
                'dashboard': 'Dashboard',
                'transacoes': 'Transa√ß√µes',
                'contas': 'Contas',
                'cartoes': 'Cart√µes de Cr√©dito',
                'investimentos': 'Investimentos',
                'processamento': 'Processamento IA',
                'relatorios': 'Relat√≥rios',
                'configuracoes': 'Configura√ß√µes'
            };
            document.getElementById('pageTitle').textContent = titles[pageId];
            
            event.target.closest('.sidebar-item').classList.add('active');
            
            // Carregar conte√∫do espec√≠fico da p√°gina
            switch(pageId) {
                case 'dashboard':
                    updateDashboard();
                    break;
                case 'transacoes':
                    updateTransactionsList();
                    break;
                case 'contas':
                    updateAccountsList();
                    break;
                case 'cartoes':
                    updateCardsList();
                    updateFaturasList();
                    break;
                case 'investimentos':
                    updateInvestmentAccountsList();
                    updateInvestmentsList();
                    updateGoalsList();
                    break;
                case 'processamento':
                    updateProcessingHistory();
                    break;
                case 'relatorios':
                    generateReport();
                    break;
                case 'configuracoes':
                    updateSystemStats();
                    break;
            }
        }

        // Dashboard
        function updateDashboard() {
            const receitas = transactions.filter(t => t.type === 'receita').reduce((sum, t) => sum + t.value, 0);
            const gastos = transactions.filter(t => t.type === 'gasto' || t.type === 'despesa').reduce((sum, t) => sum + t.value, 0);
            const saldo = receitas - gastos;
            const totalInvestimentos = investments.reduce((sum, i) => sum + i.currentValue, 0);

            document.getElementById('totalReceitas').textContent = formatCurrency(receitas);
            document.getElementById('totalGastos').textContent = formatCurrency(gastos);
            document.getElementById('saldo').textContent = formatCurrency(saldo);
            document.getElementById('totalInvestimentos').textContent = formatCurrency(totalInvestimentos);

            updateRecentTransactions();
            updateDashboardCharts();
        }

        function updateRecentTransactions() {
            const recent = transactions.slice(-5).reverse();
            const recentHtml = recent.length > 0 ? 
                recent.map(t => `
                    <div class="flex justify-between items-center p-3 border rounded-lg">
                        <div class="flex items-center space-x-3">
                            <span class="text-2xl">${getCategoryIcon(t.category)}</span>
                            <div>
                                <p class="font-medium">${t.description}</p>
                                <p class="text-sm text-gray-500">${t.category} ‚Ä¢ ${formatDate(t.date)}</p>
                            </div>
                        </div>
                        <p class="font-semibold ${t.type === 'receita' || t.type === 'investimento' ? 'text-green-600' : 'text-red-600'}">
                            ${t.type === 'receita' || t.type === 'investimento' ? '+' : '-'}${formatCurrency(Math.abs(t.value))}
                        </p>
                    </div>
                `).join('') :
                '<p class="text-gray-500 text-center py-8">Nenhuma transa√ß√£o encontrada.</p>';
            
            document.getElementById('transacoesRecentes').innerHTML = recentHtml;
        }

        function updateDashboardCharts() {
            // Gr√°fico de gastos por categoria
            const gastosCtx = document.getElementById('gastosChart').getContext('2d');
            const gastosPorCategoria = {};
            
            transactions.filter(t => t.type === 'gasto' || t.type === 'despesa').forEach(t => {
                gastosPorCategoria[t.category] = (gastosPorCategoria[t.category] || 0) + t.value;
            });

            new Chart(gastosCtx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(gastosPorCategoria),
                    datasets: [{
                        data: Object.values(gastosPorCategoria),
                        backgroundColor: Object.keys(gastosPorCategoria).map(cat => getCategoryColor(cat))
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });

            // Gr√°fico de evolu√ß√£o mensal
            const evolucaoCtx = document.getElementById('evolucaoChart').getContext('2d');
            const monthlyData = getMonthlyData();

            new Chart(evolucaoCtx, {
                type: 'line',
                data: {
                    labels: monthlyData.labels,
                    datasets: [{
                        label: 'Receitas',
                        data: monthlyData.receitas,
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)'
                    }, {
                        label: 'Gastos',
                        data: monthlyData.gastos,
                        borderColor: '#ef4444',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        // Fun√ß√µes auxiliares
        function formatCurrency(value) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(value);
        }

        function formatDate(dateString) {
            return new Date(dateString + 'T00:00:00').toLocaleDateString('pt-BR');
        }

        function getCategoryIcon(categoryName) {
            const allCategories = [...categories.gastos, ...categories.despesas, ...categories.investimentos, ...categories.receitas];
            const category = allCategories.find(c => c.name === categoryName);
            return category ? category.icon : 'üì¶';
        }

        function getCategoryColor(categoryName) {
            const allCategories = [...categories.gastos, ...categories.despesas, ...categories.investimentos, ...categories.receitas];
            const category = allCategories.find(c => c.name === categoryName);
            return category ? category.color : '#6b7280';
        }

        function getMonthlyData() {
            const monthlyData = { labels: [], receitas: [], gastos: [] };
            const months = {};
            
            transactions.forEach(t => {
                const month = t.date.substring(0, 7);
                if (!months[month]) {
                    months[month] = { receitas: 0, gastos: 0 };
                }
                if (t.type === 'receita' || t.type === 'investimento') {
                    months[month].receitas += t.value;
                } else {
                    months[month].gastos += t.value;
                }
            });

            Object.keys(months).sort().forEach(month => {
                monthlyData.labels.push(month);
                monthlyData.receitas.push(months[month].receitas);
                monthlyData.gastos.push(months[month].gastos);
            });

            return monthlyData;
        }

        // Carregar categorias
        function loadCategories() {
            const filterCategory = document.getElementById('filterCategory');
            const gastosContainer = document.getElementById('gastosCategories');
            const despesasContainer = document.getElementById('despesasCategories');
            const investimentosContainer = document.getElementById('investimentosCategories');
            const receitasContainer = document.getElementById('receitasCategories');

            if (filterCategory) {
                filterCategory.innerHTML = '<option value="">Todas as categorias</option>';
                
                categories.despesas.forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat.name;
                    option.textContent = cat.name;
                    filterCategory.appendChild(option);
                });

                categories.gastos.forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat.name;
                    option.textContent = cat.name;
                    filterCategory.appendChild(option);
                });

                categories.investimentos.forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat.name;
                    option.textContent = cat.name;
                    filterCategory.appendChild(option);
                });

                categories.receitas.forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat.name;
                    option.textContent = cat.name;
                    filterCategory.appendChild(option);
                });
            }

            if (gastosContainer) {
                gastosContainer.innerHTML = categories.gastos.map(cat => 
                    `<div class="category-chip flex justify-between items-center" style="background-color: ${cat.color}20; color: ${cat.color}; border: 1px solid ${cat.color}40;">
                        <span>${cat.icon} ${cat.name}</span>
                        <button onclick="editCategory('gastos', '${cat.name}')" class="ml-2 text-xs text-gray-500 hover:text-gray-700">‚úèÔ∏è</button>
                    </div>`
                ).join('');
            }

            if (despesasContainer) {
                despesasContainer.innerHTML = categories.despesas.map(cat => 
                    `<div class="category-chip flex justify-between items-center" style="background-color: ${cat.color}20; color: ${cat.color}; border: 1px solid ${cat.color}40;">
                        <span>${cat.icon} ${cat.name}</span>
                        <button onclick="editCategory('despesas', '${cat.name}')" class="ml-2 text-xs text-gray-500 hover:text-gray-700">‚úèÔ∏è</button>
                    </div>`
                ).join('');
            }

            if (investimentosContainer) {
                investimentosContainer.innerHTML = categories.investimentos.map(cat => 
                    `<div class="category-chip flex justify-between items-center" style="background-color: ${cat.color}20; color: ${cat.color}; border: 1px solid ${cat.color}40;">
                        <span>${cat.icon} ${cat.name}</span>
                        <button onclick="editCategory('investimentos', '${cat.name}')" class="ml-2 text-xs text-gray-500 hover:text-gray-700">‚úèÔ∏è</button>
                    </div>`
                ).join('');
            }

            if (receitasContainer) {
                receitasContainer.innerHTML = categories.receitas.map(cat => 
                    `<div class="category-chip flex justify-between items-center" style="background-color: ${cat.color}20; color: ${cat.color}; border: 1px solid ${cat.color}40;">
                        <span>${cat.icon} ${cat.name}</span>
                        <button onclick="editCategory('receitas', '${cat.name}')" class="ml-2 text-xs text-gray-500 hover:text-gray-700">‚úèÔ∏è</button>
                    </div>`
                ).join('');
            }
        }

        // Fun√ß√µes para categorias
        function showAddCategoryModal(type) {
            document.getElementById('categoryType').value = type;
            document.getElementById('addCategoryModal').classList.remove('hidden');
        }

        function closeAddCategoryModal() {
            document.getElementById('addCategoryModal').classList.add('hidden');
        }

        function selectIcon(icon) {
            document.getElementById('categoryIcon').value = icon;
            document.getElementById('selectedIcon').textContent = icon;
        }

        function editCategory(type, name) {
            alert(`Edi√ß√£o da categoria ${name} do tipo ${type} seria implementada aqui`);
        }

        // Fun√ß√µes para processamento de IA
        function showUploadModal(type) {
            currentUploadType = type;
            document.getElementById('uploadModalTitle').textContent = `Processar ${type.charAt(0).toUpperCase() + type.slice(1)}`;
            document.getElementById('uploadModal').classList.remove('hidden');
        }

        function closeUploadModal() {
            document.getElementById('uploadModal').classList.add('hidden');
        }

        function processUploadedFile() {
            const file = document.getElementById('uploadFile').files[0];
            const provider = document.getElementById('aiProvider').value;
            
            if (!file) {
                alert('Por favor, selecione um arquivo para processar.');
                return;
            }
            
            // Simula√ß√£o de processamento de IA
            console.log(`Processando ${currentUploadType} com o provedor ${provider}. Arquivo: ${file.name}`);
            
            // Dados simulados que seriam retornados pela IA
            let previewData = {};
            
            if (currentUploadType === 'contracheque') {
                previewData = {
                    description: 'Sal√°rio Mensal',
                    value: 5000.00,
                    date: new Date().toISOString().split('T')[0],
                    type: 'receita',
                    origem: 'Empresa XYZ',
                    category: 'Sal√°rio'
                };
            } else if (currentUploadType === 'extrato') {
                previewData = {
                    description: 'Pagamento Conta de Luz',
                    value: 150.00,
                    date: new Date().toISOString().split('T')[0],
                    type: 'despesa',
                    formaPagamento: 'debito',
                    category: 'Luz'
                };
            } else if (currentUploadType === 'fatura') {
                previewData = {
                    description: 'Compra Supermercado',
                    value: 350.00,
                    date: new Date().toISOString().split('T')[0],
                    type: 'despesa',
                    formaPagamento: 'credito',
                    category: 'Alimenta√ß√£o'
                };
            }
            
            // Adicionar ao hist√≥rico de processamentos
            const newProcessing = {
                id: Date.now(),
                type: currentUploadType,
                provider: provider,
                filename: file.name,
                date: new Date().toISOString().split('T')[0],
                status: 'Conclu√≠do'
            };
            
            processedDocuments.push(newProcessing);
            localStorage.setItem('financial-processed', JSON.stringify(processedDocuments));
            
            closeUploadModal();
            updateProcessingHistory();
            
            // Mostrar pr√©via da transa√ß√£o
            showTransactionPreview(previewData);
        }

        function processSMS() {
            const smsText = document.getElementById('smsText').value;
            
            if (!smsText) {
                alert('Por favor, insira o texto do SMS.');
                return;
            }
            
            // Simula√ß√£o de processamento de IA
            console.log(`Processando SMS: ${smsText}`);
            
            // Dados simulados que seriam retornados pela IA
            const previewData = {
                description: 'Compra Mercado Livre',
                value: 59.90,
                date: new Date().toISOString().split('T')[0],
                type: 'despesa',
                formaPagamento: 'credito',
                category: 'Outros'
            };
            
            // Adicionar ao hist√≥rico de processamentos
            const newProcessing = {
                id: Date.now(),
                type: 'sms',
                provider: 'openai',
                filename: 'SMS de Cart√£o',
                date: new Date().toISOString().split('T')[0],
                status: 'Conclu√≠do'
            };
            
            processedDocuments.push(newProcessing);
            localStorage.setItem('financial-processed', JSON.stringify(processedDocuments));
            
            document.getElementById('smsText').value = '';
            updateProcessingHistory();
            
            // Mostrar pr√©via da transa√ß√£o
            showTransactionPreview(previewData);
        }

        function processOCR(type) {
            const fileInput = type === 'transaction' ? 'pixTransactionFile' : 'incomeInvestmentFile';
            const file = document.getElementById(fileInput).files[0];
            
            if (!file) {
                alert('Por favor, selecione um arquivo para processar.');
                return;
            }
            
            // Simula√ß√£o de processamento de IA
            console.log(`Processando OCR para ${type}. Arquivo: ${file.name}`);
            
            // Dados simulados que seriam retornados pela IA
            let previewData = {};
            
            if (type === 'transaction') {
                previewData = {
                    description: 'Transfer√™ncia PIX',
                    value: 120.00,
                    date: new Date().toISOString().split('T')[0],
                    type: 'despesa',
                    formaPagamento: 'pix',
                    category: 'Outros'
                };
            } else {
                previewData = {
                    description: 'Rendimento Investimento',
                    value: 250.00,
                    date: new Date().toISOString().split('T')[0],
                    type: 'receita',
                    origem: 'Rendimentos',
                    category: 'Investimentos'
                };
            }
            
            // Adicionar ao hist√≥rico de processamentos
            const newProcessing = {
                id: Date.now(),
                type: type === 'transaction' ? 'pix/transa√ß√£o' : 'receita/investimento',
                provider: 'openai',
                filename: file.name,
                date: new Date().toISOString().split('T')[0],
                status: 'Conclu√≠do'
            };
            
            processedDocuments.push(newProcessing);
            localStorage.setItem('financial-processed', JSON.stringify(processedDocuments));
            
            document.getElementById(fileInput).value = '';
            updateProcessingHistory();
            
            // Mostrar pr√©via da transa√ß√£o
            showTransactionPreview(previewData);
        }

        function processDocument() {
            const file = document.getElementById('incomeInvestmentFile').files[0];
            const type = document.getElementById('documentType').value;
            
            if (!file) {
                alert('Por favor, selecione um documento para processar.');
                return;
            }
            
            // Simula√ß√£o de processamento de IA
            console.log(`Processando documento de ${type}. Arquivo: ${file.name}`);
            
            // Dados simulados que seriam retornados pela IA
            let previewData = {};
            
            if (type === 'income') {
                previewData = {
                    description: 'Pagamento Freelance',
                    value: 800.00,
                    date: new Date().toISOString().split('T')[0],
                    type: 'receita',
                    origem: 'Freelance',
                    category: 'Freelance'
                };
            } else {
                previewData = {
                    description: 'Aplica√ß√£o em CDB',
                    value: 1000.00,
                    date: new Date().toISOString().split('T')[0],
                    type: 'investimento',
                    tipoInvestimento: 'aplicacao',
                    category: 'CDB'
                };
            }
            
            // Adicionar ao hist√≥rico de processamentos
            const newProcessing = {
                id: Date.now(),
                type: type,
                provider: 'openai',
                filename: file.name,
                date: new Date().toISOString().split('T')[0],
                status: 'Conclu√≠do'
            };
            
            processedDocuments.push(newProcessing);
            localStorage.setItem('financial-processed', JSON.stringify(processedDocuments));
            
            document.getElementById('incomeInvestmentFile').value = '';
            updateProcessingHistory();
            
            // Mostrar pr√©via da transa√ß√£o
            showTransactionPreview(previewData);
        }

        function updateProcessingHistory() {
            const historyContainer = document.getElementById('processamentosHistory');
            
            if (processedDocuments.length === 0) {
                historyContainer.innerHTML = '<p class="text-gray-500 text-center py-8">Nenhum processamento realizado.</p>';
                return;
            }
            
            historyContainer.innerHTML = processedDocuments.map(p => `
                <div class="flex justify-between items-center p-3 border rounded-lg">
                    <div>
                        <p class="font-medium">${p.type.charAt(0).toUpperCase() + p.type.slice(1)}: ${p.filename}</p>
                        <p class="text-sm text-gray-500">Provedor: ${p.provider} ‚Ä¢ ${formatDate(p.date)}</p>
                    </div>
                    <span class="px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs font-medium">${p.status}</span>
                </div>
            `).join('');
        }

        // Fun√ß√µes para pr√©via de transa√ß√£o
        function showTransactionPreview(data) {
            currentPreviewData = data;
            
            // Preencher campos comuns
            document.getElementById('previewDescription').value = data.description || '';
            document.getElementById('previewValue').value = data.value || 0;
            document.getElementById('previewDate').value = data.date || new Date().toISOString().split('T')[0];
            document.getElementById('previewType').value = data.type || 'receita';
            
            // Preencher campos espec√≠ficos
            if (data.type === 'receita') {
                document.getElementById('previewOrigemReceita').value = data.origem || '';
                populateAccountsSelect('previewContaDestinoReceita');
                populateCategoriesSelect('previewCategoriaReceita', 'receitas');
                if (data.category) {
                    document.getElementById('previewCategoriaReceita').value = data.category;
                }
            } else if (data.type === 'despesa' || data.type === 'gasto') {
                document.getElementById('previewFormaPagamento').value = data.formaPagamento || 'credito';
                populateCardsSelect('previewCartaoCredito');
                populateAccountsSelect('previewContaOrigem');
                populateCategoriesSelect('previewCategoriaDespesa', data.type === 'despesa' ? 'despesas' : 'gastos');
                if (data.category) {
                    document.getElementById('previewCategoriaDespesa').value = data.category;
                }
                updateFormaPagamentoFields();
            } else if (data.type === 'investimento') {
                document.getElementById('previewTipoInvestimento').value = data.tipoInvestimento || 'aplicacao';
                populateAccountsSelect('previewContaOrigemInvestimento');
                populateAccountsSelect('previewContaDestinoResgate');
                populateInvestmentsSelect('previewInvestimentoDestino');
                populateInvestmentsSelect('previewInvestimentoOrigem');
                updateInvestimentoFields();
            }
            
            // Mostrar campos espec√≠ficos do tipo
            updatePreviewFields();
            
            // Mostrar modal
            document.getElementById('transactionPreviewModal').classList.remove('hidden');
        }

        function closeTransactionPreviewModal() {
            document.getElementById('transactionPreviewModal').classList.add('hidden');
        }

        function updatePreviewFields() {
            const type = document.getElementById('previewType').value;
            
            // Esconder todos os campos espec√≠ficos
            document.getElementById('previewReceitaFields').classList.add('hidden');
            document.getElementById('previewDespesaFields').classList.add('hidden');
            document.getElementById('previewInvestimentoFields').classList.add('hidden');
            
            // Mostrar campos espec√≠ficos do tipo selecionado
            if (type === 'receita') {
                document.getElementById('previewReceitaFields').classList.remove('hidden');
            } else if (type === 'despesa') {
                document.getElementById('previewDespesaFields').classList.remove('hidden');
            } else if (type === 'investimento') {
                document.getElementById('previewInvestimentoFields').classList.remove('hidden');
            }
        }

        function updateFormaPagamentoFields() {
            const formaPagamento = document.getElementById('previewFormaPagamento').value;
            
            if (formaPagamento === 'credito') {
                document.getElementById('previewCreditoFields').classList.remove('hidden');
                document.getElementById('previewDebitoPixTransfFields').classList.add('hidden');
            } else {
                document.getElementById('previewCreditoFields').classList.add('hidden');
                document.getElementById('previewDebitoPixTransfFields').classList.remove('hidden');
            }
        }

        function updateInvestimentoFields() {
            const tipoInvestimento = document.getElementById('previewTipoInvestimento').value;
            
            if (tipoInvestimento === 'aplicacao') {
                document.getElementById('previewAplicacaoFields').classList.remove('hidden');
                document.getElementById('previewResgateFields').classList.add('hidden');
            } else {
                document.getElementById('previewAplicacaoFields').classList.add('hidden');
                document.getElementById('previewResgateFields').classList.remove('hidden');
            }
        }

        function toggleNovoInvestimentoFields() {
            const isChecked = document.getElementById('previewNovoInvestimento').checked;
            
            if (isChecked) {
                document.getElementById('previewNovoInvestimentoFields').classList.remove('hidden');
                document.getElementById('previewInvestimentoDestino').disabled = true;
            } else {
                document.getElementById('previewNovoInvestimentoFields').classList.add('hidden');
                document.getElementById('previewInvestimentoDestino').disabled = false;
            }
        }

        function populateAccountsSelect(selectId) {
            const select = document.getElementById(selectId);
            select.innerHTML = '<option value="">Selecione uma conta</option>';
            
            accounts.forEach(account => {
                const option = document.createElement('option');
                option.value = account.id;
                option.textContent = account.name;
                select.appendChild(option);
            });
        }

        function populateCardsSelect(selectId) {
            const select = document.getElementById(selectId);
            select.innerHTML = '<option value="">Selecione um cart√£o</option>';
            
            cards.forEach(card => {
                const option = document.createElement('option');
                option.value = card.id;
                option.textContent = card.name;
                select.appendChild(option);
            });
        }

        function populateInvestmentsSelect(selectId) {
            const select = document.getElementById(selectId);
            select.innerHTML = '<option value="">Selecione um investimento</option>';
            
            investments.forEach(investment => {
                const option = document.createElement('option');
                option.value = investment.id;
                option.textContent = investment.name;
                select.appendChild(option);
            });
        }

        function populateCategoriesSelect(selectId, categoryType) {
            const select = document.getElementById(selectId);
            select.innerHTML = '<option value="">Selecione uma categoria</option>';
            
            categories[categoryType].forEach(cat => {
                const option = document.createElement('option');
                option.value = cat.name;
                option.textContent = cat.name;
                select.appendChild(option);
            });
        }

        function saveTransaction() {
            const type = document.getElementById('previewType').value;
            const description = document.getElementById('previewDescription').value;
            const value = parseFloat(document.getElementById('previewValue').value);
            const date = document.getElementById('previewDate').value;
            
            if (!description || isNaN(value) || value <= 0 || !date) {
                alert('Por favor, preencha todos os campos obrigat√≥rios.');
                return;
            }
            
            let transaction = {
                id: Date.now(),
                description,
                value,
                date,
                type
            };
            
            // Adicionar campos espec√≠ficos
            if (type === 'receita') {
                transaction.origem = document.getElementById('previewOrigemReceita').value;
                transaction.contaDestino = document.getElementById('previewContaDestinoReceita').value;
                transaction.category = document.getElementById('previewCategoriaReceita').value;
            } else if (type === 'despesa') {
                const formaPagamento = document.getElementById('previewFormaPagamento').value;
                transaction.formaPagamento = formaPagamento;
                
                if (formaPagamento === 'credito') {
                    transaction.cartaoCredito = document.getElementById('previewCartaoCredito').value;
                } else {
                    transaction.contaOrigem = document.getElementById('previewContaOrigem').value;
                }
                
                transaction.category = document.getElementById('previewCategoriaDespesa').value;
            } else if (type === 'investimento') {
                const tipoInvestimento = document.getElementById('previewTipoInvestimento').value;
                transaction.tipoInvestimento = tipoInvestimento;
                
                if (tipoInvestimento === 'aplicacao') {
                    transaction.contaOrigem = document.getElementById('previewContaOrigemInvestimento').value;
                    
                    if (document.getElementById('previewNovoInvestimento').checked) {
                        // Criar novo investimento
                        const novoInvestimento = {
                            id: Date.now() + 1,
                            name: document.getElementById('previewNovoInvestimentoNome').value,
                            type: document.getElementById('previewNovoInvestimentoTipo').value,
                            institution: document.getElementById('previewNovoInvestimentoInstituicao').value,
                            rate: parseFloat(document.getElementById('previewNovoInvestimentoTaxa').value),
                            initialValue: value,
                            currentValue: value,
                            startDate: date
                        };
                        
                        const investmentType = document.getElementById('previewNovoInvestimentoTipo').value;
                        if (investmentTypes[investmentType].hasSubtype) {
                            novoInvestimento.subtype = document.getElementById('previewNovoInvestimentoSubtipo').value;
                        }
                        
                        investments.push(novoInvestimento);
                        localStorage.setItem('financial-investments', JSON.stringify(investments));
                        
                        transaction.investimentoDestino = novoInvestimento.id;
                    } else {
                        transaction.investimentoDestino = document.getElementById('previewInvestimentoDestino').value;
                    }
                } else {
                    transaction.investimentoOrigem = document.getElementById('previewInvestimentoOrigem').value;
                    transaction.contaDestino = document.getElementById('previewContaDestinoResgate').value;
                }
            }
            
            // Adicionar transa√ß√£o
            transactions.push(transaction);
            localStorage.setItem('financial-transactions', JSON.stringify(transactions));
            
            // Atualizar saldos
            updateBalances(transaction);
            
            // Fechar modal
            closeTransactionPreviewModal();
            
            // Atualizar interface
            updateDashboard();
            updateTransactionsList();
            
            alert('Transa√ß√£o salva com sucesso!');
        }

        function updateBalances(transaction) {
            if (transaction.type === 'receita') {
                const contaDestino = accounts.find(a => a.id === transaction.contaDestino);
                if (contaDestino) {
                    contaDestino.balance += transaction.value;
                }
            } else if (transaction.type === 'despesa') {
                if (transaction.formaPagamento === 'credito') {
                    const cartao = cards.find(c => c.id === transaction.cartaoCredito);
                    if (cartao) {
                        cartao.usedLimit += transaction.value;
                    }
                } else {
                    const contaOrigem = accounts.find(a => a.id === transaction.contaOrigem);
                    if (contaOrigem) {
                        contaOrigem.balance -= transaction.value;
                    }
                }
            } else if (transaction.type === 'investimento') {
                if (transaction.tipoInvestimento === 'aplicacao') {
                    const contaOrigem = accounts.find(a => a.id === transaction.contaOrigem);
                    if (contaOrigem) {
                        contaOrigem.balance -= transaction.value;
                    }
                    
                    const investimento = investments.find(i => i.id === transaction.investimentoDestino);
                    if (investimento) {
                        investimento.currentValue += transaction.value;
                    }
                } else {
                    const investimento = investments.find(i => i.id === transaction.investimentoOrigem);
                    if (investimento) {
                        investimento.currentValue -= transaction.value;
                    }
                    
                    const contaDestino = accounts.find(a => a.id === transaction.contaDestino);
                    if (contaDestino) {
                        contaDestino.balance += transaction.value;
                    }
                }
            }
            
            localStorage.setItem('financial-accounts', JSON.stringify(accounts));
            localStorage.setItem('financial-cards', JSON.stringify(cards));
            localStorage.setItem('financial-investments', JSON.stringify(investments));
        }

        // Fun√ß√µes para contas
        function updateAccountsList() {
            const contasList = document.getElementById('contasList');
            
            if (accounts.length === 0) {
                contasList.innerHTML = '<div class="col-span-full"><p class="text-gray-500 text-center py-8">Nenhuma conta encontrada.</p></div>';
                return;
            }
            
            contasList.innerHTML = accounts.map(account => `
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <h3 class="font-semibold">${account.name}</h3>
                            <p class="text-sm text-gray-600">${account.bank}</p>
                        </div>
                        <span class="text-2xl">${account.type === 'corrente' ? 'üè¶' : 'üí∞'}</span>
                    </div>
                    <div class="border-t pt-4">
                        <p class="text-sm text-gray-600">Saldo</p>
                        <p class="text-xl font-bold ${account.balance >= 0 ? 'text-green-600' : 'text-red-600'}">${formatCurrency(account.balance)}</p>
                    </div>
                    <div class="flex justify-end mt-4">
                        <button onclick="editAccount(${account.id})" class="text-blue-600 hover:text-blue-800 mr-3">Editar</button>
                        <button onclick="deleteAccount(${account.id})" class="text-red-600 hover:text-red-800">Excluir</button>
                    </div>
                </div>
            `).join('');
        }

        function showAddAccountModal() {
            document.getElementById('addAccountModal').classList.remove('hidden');
        }

        function closeAddAccountModal() {
            document.getElementById('addAccountModal').classList.add('hidden');
        }

        // Fun√ß√µes para cart√µes
        function updateCardsList() {
            const cartoesList = document.getElementById('cartoesList');
            
            if (cards.length === 0) {
                cartoesList.innerHTML = '<div class="col-span-full"><p class="text-gray-500 text-center py-8">Nenhum cart√£o encontrado.</p></div>';
                return;
            }
            
            cartoesList.innerHTML = cards.map(card => `
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <h3 class="font-semibold">${card.name}</h3>
                            <p class="text-sm text-gray-600">${card.bank} ‚Ä¢ ${card.flag.toUpperCase()}</p>
                        </div>
                        <span class="text-2xl">üí≥</span>
                    </div>
                    <div class="border-t pt-4">
                        <div class="flex justify-between mb-2">
                            <p class="text-sm text-gray-600">Limite Total</p>
                            <p class="font-medium">${formatCurrency(card.limit)}</p>
                        </div>
                        <div class="flex justify-between mb-2">
                            <p class="text-sm text-gray-600">Limite Usado</p>
                            <p class="font-medium text-red-600">${formatCurrency(card.usedLimit || 0)}</p>
                        </div>
                        <div class="flex justify-between">
                            <p class="text-sm text-gray-600">Limite Dispon√≠vel</p>
                            <p class="font-medium text-green-600">${formatCurrency(card.limit - (card.usedLimit || 0))}</p>
                        </div>
                    </div>
                    <div class="border-t pt-4 mt-4">
                        <div class="flex justify-between">
                            <p class="text-sm text-gray-600">Vencimento: dia ${card.dueDay}</p>
                            <p class="text-sm text-gray-600">Fechamento: dia ${card.closingDay}</p>
                        </div>
                    </div>
                    <div class="flex justify-end mt-4">
                        <button onclick="viewFatura(${card.id})" class="text-blue-600 hover:text-blue-800 mr-3">Ver Fatura</button>
                        <button onclick="editCard(${card.id})" class="text-blue-600 hover:text-blue-800 mr-3">Editar</button>
                        <button onclick="deleteCard(${card.id})" class="text-red-600 hover:text-red-800">Excluir</button>
                    </div>
                </div>
            `).join('');
        }

        function updateFaturasList() {
            const faturasList = document.getElementById('faturasList');
            
            // Simula√ß√£o de faturas
            const faturas = [];
            cards.forEach(card => {
                const today = new Date();
                const month = today.getMonth();
                const year = today.getFullYear();
                
                faturas.push({
                    id: Date.now() + card.id,
                    cardId: card.id,
                    cardName: card.name,
                    month: month,
                    year: year,
                    value: card.usedLimit || 0,
                    status: 'Aberta'
                });
                
                faturas.push({
                    id: Date.now() + card.id + 1,
                    cardId: card.id,
                    cardName: card.name,
                    month: month - 1 < 0 ? 11 : month - 1,
                    year: month - 1 < 0 ? year - 1 : year,
                    value: Math.random() * 1000 + 500,
                    status: 'Fechada'
                });
            });
            
            if (faturas.length === 0) {
                faturasList.innerHTML = '<p class="text-gray-500 text-center py-8">Nenhuma fatura encontrada.</p>';
                return;
            }
            
            const monthNames = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
            
            faturasList.innerHTML = faturas.map(fatura => `
                <div class="flex justify-between items-center p-3 border rounded-lg">
                    <div>
                        <p class="font-medium">${fatura.cardName} - ${monthNames[fatura.month]} de ${fatura.year}</p>
                        <p class="text-sm text-gray-500">Valor: ${formatCurrency(fatura.value)}</p>
                    </div>
                    <div class="flex items-center">
                        <span class="px-2 py-1 ${fatura.status === 'Aberta' ? 'bg-yellow-100 text-yellow-800' : 'bg-green-100 text-green-800'} rounded-full text-xs font-medium mr-2">${fatura.status}</span>
                        <button onclick="viewFaturaDetails(${fatura.id})" class="text-blue-600 hover:text-blue-800">Ver</button>
                    </div>
                </div>
            `).join('');
        }

        function showAddCardModal() {
            document.getElementById('addCardModal').classList.remove('hidden');
        }

        function closeAddCardModal() {
            document.getElementById('addCardModal').classList.add('hidden');
        }

        function viewFatura(cardId) {
            alert(`Visualiza√ß√£o da fatura do cart√£o ${cardId} seria implementada aqui`);
        }

        function viewFaturaDetails(faturaId) {
            alert(`Visualiza√ß√£o dos detalhes da fatura ${faturaId} seria implementada aqui`);
        }

        // Fun√ß√µes para investimentos
        function updateInvestmentAccountsList() {
            const investmentAccountsList = document.getElementById('investmentAccountsList');
            
            if (investmentAccounts.length === 0) {
                investmentAccountsList.innerHTML = '<p class="text-gray-500 text-center py-8">Nenhuma conta de investimento encontrada.</p>';
                return;
            }
            
            investmentAccountsList.innerHTML = investmentAccounts.map(account => `
                <div class="flex justify-between items-center p-3 border rounded-lg">
                    <div>
                        <p class="font-medium">${account.name}</p>
                        <p class="text-sm text-gray-500">${account.institution} ‚Ä¢ Saldo: ${formatCurrency(account.balance)}</p>
                    </div>
                    <div class="flex items-center">
                        <button onclick="editInvestmentAccount(${account.id})" class="text-blue-600 hover:text-blue-800 mr-2">Editar</button>
                        <button onclick="deleteInvestmentAccount(${account.id})" class="text-red-600 hover:text-red-800">Excluir</button>
                    </div>
                </div>
            `).join('');
        }

        function updateInvestmentsList() {
            const investmentsList = document.getElementById('investmentsList');
            
            if (investments.length === 0) {
                investmentsList.innerHTML = '<p class="text-gray-500 text-center py-8">Nenhum investimento encontrado.</p>';
                return;
            }
            
            investmentsList.innerHTML = investments.map(investment => `
                <div class="flex justify-between items-center p-3 border rounded-lg">
                    <div>
                        <p class="font-medium">${investment.name}</p>
                        <p class="text-sm text-gray-500">${investment.type.toUpperCase()} ‚Ä¢ ${investment.institution}</p>
                        <p class="text-sm text-gray-500">Valor Atual: ${formatCurrency(investment.currentValue)}</p>
                    </div>
                    <div class="flex items-center">
                        <button onclick="viewInvestment(${investment.id})" class="text-blue-600 hover:text-blue-800 mr-2">Ver</button>
                        <button onclick="editInvestment(${investment.id})" class="text-blue-600 hover:text-blue-800 mr-2">Editar</button>
                        <button onclick="deleteInvestment(${investment.id})" class="text-red-600 hover:text-red-800">Excluir</button>
                    </div>
                </div>
            `).join('');
        }

        function updateGoalsList() {
            const goalsList = document.getElementById('goalsList');
            
            if (goals.length === 0) {
                goalsList.innerHTML = '<p class="text-gray-500 text-center py-8">Nenhuma meta encontrada.</p>';
                return;
            }
            
            goalsList.innerHTML = goals.map(goal => `
                <div class="flex justify-between items-center p-3 border rounded-lg">
                    <div>
                        <p class="font-medium">${goal.name}</p>
                        <p class="text-sm text-gray-500">Meta: ${formatCurrency(goal.targetValue)} ‚Ä¢ Atual: ${formatCurrency(goal.currentValue)}</p>
                        <div class="w-full bg-gray-200 rounded-full h-2.5 mt-2">
                            <div class="bg-blue-600 h-2.5 rounded-full" style="width: ${Math.min(100, (goal.currentValue / goal.targetValue) * 100)}%"></div>
                        </div>
                    </div>
                    <div class="flex items-center">
                        <button onclick="editGoal(${goal.id})" class="text-blue-600 hover:text-blue-800 mr-2">Editar</button>
                        <button onclick="deleteGoal(${goal.id})" class="text-red-600 hover:text-red-800">Excluir</button>
                    </div>
                </div>
            `).join('');
        }

        function showAddInvestmentAccountModal() {
            document.getElementById('addInvestmentAccountModal').classList.remove('hidden');
        }

        function closeAddInvestmentAccountModal() {
            document.getElementById('addInvestmentAccountModal').classList.add('hidden');
        }

        function showAddInvestmentModal() {
            alert('Modal de adicionar investimento seria implementado aqui');
        }

        function showAddGoalModal() {
            alert('Modal de adicionar meta seria implementado aqui');
        }

        // Configurar event listeners
        function setupEventListeners() {
            // Formul√°rio de adicionar categoria
            const addCategoryForm = document.getElementById('addCategoryForm');
            if (addCategoryForm) {
                addCategoryForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const type = document.getElementById('categoryType').value;
                    const name = document.getElementById('categoryName').value;
                    const icon = document.getElementById('categoryIcon').value;
                    const color = document.getElementById('categoryColor').value;
                    
                    if (!name) {
                        alert('Por favor, insira um nome para a categoria.');
                        return;
                    }
                    
                    // Adicionar nova categoria
                    categories[type].push({
                        name: name,
                        icon: icon,
                        color: color
                    });
                    
                    // Salvar categorias no localStorage
                    localStorage.setItem('financial-categories', JSON.stringify(categories));
                    
                    // Atualizar interface
                    loadCategories();
                    closeAddCategoryModal();
                });
            }

            // Formul√°rio de adicionar conta
            const addAccountForm = document.getElementById('addAccountForm');
            if (addAccountForm) {
                addAccountForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const name = document.getElementById('accountName').value;
                    const type = document.getElementById('accountType').value;
                    const bank = document.getElementById('accountBank').value;
                    const balance = parseFloat(document.getElementById('accountBalance').value);
                    
                    if (!name || !bank || isNaN(balance)) {
                        alert('Por favor, preencha todos os campos.');
                        return;
                    }
                    
                    // Adicionar nova conta
                    accounts.push({
                        id: Date.now(),
                        name: name,
                        type: type,
                        bank: bank,
                        balance: balance
                    });
                    
                    // Salvar contas no localStorage
                    localStorage.setItem('financial-accounts', JSON.stringify(accounts));
                    
                    // Atualizar interface
                    updateAccountsList();
                    closeAddAccountModal();
                });
            }

            // Formul√°rio de adicionar cart√£o
            const addCardForm = document.getElementById('addCardForm');
            if (addCardForm) {
                addCardForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const name = document.getElementById('cardName').value;
                    const bank = document.getElementById('cardBank').value;
                    const flag = document.getElementById('cardFlag').value;
                    const limit = parseFloat(document.getElementById('cardLimit').value);
                    const dueDay = parseInt(document.getElementById('cardDueDay').value);
                    const closingDay = parseInt(document.getElementById('cardClosingDay').value);
                    
                    if (!name || !bank || isNaN(limit) || isNaN(dueDay) || isNaN(closingDay)) {
                        alert('Por favor, preencha todos os campos.');
                        return;
                    }
                    
                    // Adicionar novo cart√£o
                    cards.push({
                        id: Date.now(),
                        name: name,
                        bank: bank,
                        flag: flag,
                        limit: limit,
                        dueDay: dueDay,
                        closingDay: closingDay,
                        usedLimit: 0
                    });
                    
                    // Salvar cart√µes no localStorage
                    localStorage.setItem('financial-cards', JSON.stringify(cards));
                    
                    // Atualizar interface
                    updateCardsList();
                    closeAddCardModal();
                });
            }

            // Formul√°rio de adicionar conta de investimento
            const addInvestmentAccountForm = document.getElementById('addInvestmentAccountForm');
            if (addInvestmentAccountForm) {
                addInvestmentAccountForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const name = document.getElementById('investmentAccountName').value;
                    const institution = document.getElementById('investmentAccountBank').value;
                    const balance = parseFloat(document.getElementById('investmentAccountBalance').value);
                    
                    if (!name || !institution || isNaN(balance)) {
                        alert('Por favor, preencha todos os campos.');
                        return;
                    }
                    
                    // Adicionar nova conta de investimento
                    investmentAccounts.push({
                        id: Date.now(),
                        name: name,
                        institution: institution,
                        balance: balance
                    });
                    
                    // Salvar contas de investimento no localStorage
                    localStorage.setItem('financial-investment-accounts', JSON.stringify(investmentAccounts));
                    
                    // Atualizar interface
                    updateInvestmentAccountsList();
                    closeAddInvestmentAccountModal();
                });
            }

            // Evento de mudan√ßa no tipo de investimento
            const previewNovoInvestimentoTipo = document.getElementById('previewNovoInvestimentoTipo');
            if (previewNovoInvestimentoTipo) {
                previewNovoInvestimentoTipo.addEventListener('change', function() {
                    const type = this.value;
                    const subtipoContainer = document.getElementById('previewSubtipoContainer');
                    const subtipoLabel = document.querySelector('#previewSubtipoContainer label');
                    
                    if (investmentTypes[type].hasSubtype) {
                        subtipoContainer.classList.remove('hidden');
                        subtipoLabel.textContent = investmentTypes[type].subtypeLabel;
                    } else {
                        subtipoContainer.classList.add('hidden');
                    }
                });
            }

            // Evento de mudan√ßa no tipo de transa√ß√£o
            const previewType = document.getElementById('previewType');
            if (previewType) {
                previewType.addEventListener('change', updatePreviewFields);
            }

            // Evento de mudan√ßa na forma de pagamento
            const previewFormaPagamento = document.getElementById('previewFormaPagamento');
            if (previewFormaPagamento) {
                previewFormaPagamento.addEventListener('change', updateFormaPagamentoFields);
            }

            // Evento de mudan√ßa no tipo de investimento
            const previewTipoInvestimento = document.getElementById('previewTi
